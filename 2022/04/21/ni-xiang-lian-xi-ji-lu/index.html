<!DOCTYPE HTML>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="逆向练习记录, あなたがいること.">
    <meta name="description" content="好好学习，天天向上


常规不一样的Flag题目大概是一个走迷宫的小游戏
Flag就是走迷宫的顺序
主逻辑如图

拆解一下游戏玩法
//开局信息
v4 = 0;
strcpy(Table, &#34;*11110100001010000101111">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>逆向练习记录 | あなたがいること.</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">あなたがいること.</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>Index</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>Tags</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>Categories</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>Archives</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>About</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="Search" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">あなたがいること.</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			Index
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			Tags
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			Categories
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			Archives
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			About
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('https://raw.githubusercontent.com/Luluting/Bed/Little/img/QQ%E5%9B%BE%E7%89%8720220311191653.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">逆向练习记录</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/CTF/">
                                <span class="chip bg-color">CTF</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Reverse/" class="post-category">
                                Reverse
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2022-04-21
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>Update Date:&nbsp;&nbsp;
                    2022-05-15
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>Word Count:&nbsp;&nbsp;
                    12.8k
                </div>
                

                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>Read Count:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>好好学习，天天向上</p>
<span id="more"></span>

<h1 id="常规"><a href="#常规" class="headerlink" title="常规"></a>常规</h1><h2 id="不一样的Flag"><a href="#不一样的Flag" class="headerlink" title="不一样的Flag"></a>不一样的Flag</h2><p>题目大概是一个走迷宫的小游戏</p>
<p>Flag就是走迷宫的顺序</p>
<p>主逻辑如图</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220420150104949.png" alt="image-20220420150104949"></p>
<p>拆解一下游戏玩法</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">//开局信息
v4 = 0;
strcpy(Table, "*11110100001010000101111#"); //长度25的字符串
2A 31 31 31 31 30 31 30  30 30 30 31 30 31 30 30
30 30 31 30 31 31 31 31  23 00 00 00 FF FF FF FF

//用户可操作选择
if ( SingInput == 1 )
	--*(_DWORD *)&amp;Table[25]; //up
if ( SingInput == 2 )
    ++*(_DWORD *)&amp;Table[25]; //down
if ( SingInput == 3 )
	--v4; //left
if ( SingInput == 4 )
	++v4; //right

//验证逻辑
    for ( i = 0; i &lt;= 1; ++i )
    {
      if ( *(int *)&amp;Table[4 * i + 25] &lt; 0 || *(int *)&amp;Table[4 * i + 25] &gt; 4 )
        exit(1);
    }
    if ( Cert[5 * *(_DWORD *)&amp;Table[25] - 41 + v4] == '1' )
      exit(1);
    if ( Cert[5 * *(_DWORD *)&amp;Table[25] - 41 + v4] == 35 )
    {
      puts("\nok, the order you enter is the flag!");
      exit(0);
    }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在这里我不知道CERT的值 所以会感觉无从下手</p>
<p>但看到迷宫验证的时候是5成一排</p>
<pre class="line-numbers language-none"><code class="language-none">*1111
01000
01010
00010
1111#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>按照提示走迷宫</p>
<p>得到222441144222</p>
<p>尝试之后正确</p>
<p>可以得知<code>Cert[5 * *(_DWORD *)&amp;Table[25] - 41 + v4]</code>就是我们迷宫当前所在的位置</p>
<h2 id="SimpleRev"><a href="#SimpleRev" class="headerlink" title="SimpleRev"></a>SimpleRev</h2><h3 id="题目内容"><a href="#题目内容" class="headerlink" title="题目内容"></a>题目内容</h3><p>校验字符串</p>
<p>通过拼接操作形成长度128字节的Key </p>
<p>程序根据用户输入变形一个Table</p>
<p>将key与变形后的一个Table对比</p>
<p>若一致则成功</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">key1<span class="token operator">=</span><span class="token string">"ADSFK"</span><span class="token punctuation">;</span>

key3<span class="token operator">=</span><span class="token string">"kills"</span><span class="token punctuation">;</span>

something<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0x776F646168LL</span><span class="token punctuation">;</span> <span class="token comment">//'wodah'</span>

something<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0LL</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="join函数"><a href="#join函数" class="headerlink" title="join函数"></a>join函数</h3><p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220421155339682.png" alt="image-20220421155339682"></p>
<p>没啥特别的</p>
<p>就是拼接</p>
<p>key3+something</p>
<p>注意something需要倒序（小端存储）</p>
<p>text=”killshadow”</p>
<h3 id="key处理"><a href="#key处理" class="headerlink" title="key处理"></a>key处理</h3><p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220421170306566.png" alt="image-20220421170306566"></p>
<p>key=”ADSFKNDCLS”</p>
<p>经过一波小写转换操作</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220421171902475.png" alt="image-20220421171902475"></p>
<p>key=adsfkndcls”</p>
<p>处理之后<code>v3=0x0a</code></p>
<h3 id="Table生成"><a href="#Table生成" class="headerlink" title="Table生成"></a>Table生成</h3><p>key=adsfkndcls”</p>
<p>input = “a”</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">while ( 1 )
{
  input = getchar();
  if ( input == 10 )
    break;
  if ( input == 32 )
  {
    ++spaceOrder;                             // spaceNum
  }
  else
  {
    if ( input &lt;= 96 || input &gt; 122 )
    {
      if ( input &gt; 64 &amp;&amp; input &lt;= 90 )        // 大写字母
      {
        Table[spaceOrder] = (input - 39 - key[v3 % v5] + 97) % 26 + 97;
        ++v3;
      }
    }
    else                                      // 小写字母
    {
      Table[spaceOrder] = (input - 39 - key[v3 % v5] + 97) % 26 + 97;
      ++v3;
    }
    if ( !(v3 % v5) )
      putchar(32);
    ++spaceOrder;
  }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后比较Table与Text</p>
<pre class="line-numbers language-none"><code class="language-none">text="killshadow"
char Table[104]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>





<h3 id="我的尝试"><a href="#我的尝试" class="headerlink" title="我的尝试"></a>我的尝试</h3><p>看了下算法大致是通过输入大写字母来生成text</p>
<p>于是通过逆向还原一下 通过最后将计算结果放大到大写字母的范围内</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Table[spaceOrder] = (input - 39 - key[v3 % key_len] + 97) % 26 + 97;</span>
<span class="token keyword">def</span> <span class="token function">fangda</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token number">65</span> <span class="token operator">&lt;=</span> a <span class="token operator">&lt;=</span><span class="token number">90</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> a <span class="token operator">&gt;</span> <span class="token number">122</span><span class="token punctuation">:</span>
            a <span class="token operator">-=</span> <span class="token number">26</span>
        <span class="token keyword">elif</span> a <span class="token operator">&lt;</span> <span class="token number">65</span><span class="token punctuation">:</span>
            a <span class="token operator">+=</span> <span class="token number">26</span>
    <span class="token keyword">return</span> a

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    mylist <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    key <span class="token operator">=</span> <span class="token string">'adsfkndcls'</span>
    final <span class="token operator">=</span> <span class="token string">"killshadow"</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>final<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">97</span>
        temp <span class="token operator">-=</span> <span class="token number">97</span>
        temp <span class="token operator">+=</span> <span class="token number">39</span>
        temp <span class="token operator">+=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        temp <span class="token operator">=</span> fangda<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
        mylist<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span>mylist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="别人的解法"><a href="#别人的解法" class="headerlink" title="别人的解法"></a>别人的解法</h3><p>非常简短</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">key <span class="token operator">=</span> <span class="token string">'adsfkndcls'</span>
text <span class="token operator">=</span> <span class="token string">'killshadow'</span>
v5 <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">65</span><span class="token punctuation">,</span><span class="token number">91</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#仅遍历大写字母</span>
         <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>text<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token punctuation">(</span>j <span class="token operator">-</span> <span class="token number">39</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i <span class="token operator">%</span> v5<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">97</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">26</span> <span class="token operator">+</span> <span class="token number">97</span><span class="token punctuation">:</span>
             flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看到思路是直接进行爆破</p>
<p>利用了密码本的特性</p>
<p>直接遍历大写字母生成Table值来和text比较</p>
<p>如果符合则加入</p>
<h2 id="Luck-guy"><a href="#Luck-guy" class="headerlink" title="Luck_guy"></a>Luck_guy</h2><p>Linux64位程序</p>
<h3 id="题目结构"><a href="#题目结构" class="headerlink" title="题目结构"></a>题目结构</h3><p>主函数</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl main(int argc, const char **argv, const char **envp)
{
  welcome(argc, argv, envp);
  puts("_________________");
  puts("try to patch me and find flag");
  puts("please input a lucky number");
  __isoc99_scanf("%d");
  patch_me(0);
  puts("OK,see you again");
  return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>patch_me函数</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int __fastcall patch_me(int a1)
{
  int result; // eax

  if ( a1 % 2 == 1 )
    result = puts("just finished");
  else
    result = get_flag();
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>get_flag()函数</p>
<p>case3可以看到小彩蛋</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">unsigned __int64 get_flag()
{
  unsigned int v0; // eax
  int i; // [rsp+4h] [rbp-3Ch]
  int j; // [rsp+8h] [rbp-38h]
  __int64 s; // [rsp+10h] [rbp-30h] BYREF
  char v5; // [rsp+18h] [rbp-28h]
  unsigned __int64 v6; // [rsp+38h] [rbp-8h]

  v6 = __readfsqword(0x28u);
  v0 = time(0LL);
  srand(v0);
  for ( i = 0; i &lt;= 4; ++i )
  {
    switch ( rand() % 200 )
    {
      case 1:
        puts("OK, it's flag:");
        memset(&amp;s, 0, 0x28uLL);
        strcat((char *)&amp;s, f1);
        strcat((char *)&amp;s, &amp;f2);
        printf("%s", (const char *)&amp;s);
        break;
      case 2:
        printf("Solar not like you");
        break;
      case 3:
        printf("Solar want a girlfriend");
        break;
      case 4:
        s = 0x7F666F6067756369LL;
        v5 = 0;
        strcat(&amp;f2, (const char *)&amp;s);
        break;
      case 5:
        for ( j = 0; j &lt;= 7; ++j )
        {
          if ( j % 2 == 1 )
            *(&amp;f2 + j) -= 2;
          else
            --*(&amp;f2 + j);
        }
        break;
      default:
        puts("emmm,you can't find flag 23333");
        break;
    }
  }
  return __readfsqword(0x28u) ^ v6;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="patch-me-处理"><a href="#patch-me-处理" class="headerlink" title="patch_me()处理"></a>patch_me()处理</h3><p>可以看到patch_me函数按照正常逻辑无法进入get_flag函数</p>
<p><img src="%E9%80%86%E5%90%91%E7%BB%83%E4%B9%A0%E8%AE%B0%E5%BD%95.assets/image-20220422132652906.png" alt="image-20220422132652906"></p>
<p>于是在鼠标指向的条件判断出patch一下，将jnz改为jmp指令</p>
<p>再次反汇编可以看到能顺利执行get_flag函数了</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">unsigned __int64 __fastcall patch_me(int a1)
{
  return get_flag();
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="get-flag-处理"><a href="#get-flag-处理" class="headerlink" title="get_flag()处理"></a>get_flag()处理</h3><p>关键逻辑如下</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">v0 = time(0LL);
srand(v0);
for ( i = 0; i &lt;= 4; ++i )
{
  switch ( rand() % 200 )
  {
    case 1:
      puts("OK, it's flag:");
      memset(&amp;s, 0, 0x28uLL);
      strcat((char *)&amp;s, f1);
      strcat((char *)&amp;s, &amp;f2);
      printf("%s", (const char *)&amp;s);
      break;
    case 2:
      printf("Solar not like you");
      break;
    case 3:
      printf("Solar want a girlfriend");
      break;
    case 4:
      s = '\x7Ffo`guci';
      v5 = 0;
      strcat(&amp;f2, (const char *)&amp;s);
      break;
    case 5:
      for ( j = 0; j &lt;= 7; ++j )
      {
        if ( j % 2 == 1 )
          *(&amp;f2 + j) -= 2;
        else
          --*(&amp;f2 + j);
      }
      break;
    default:
      puts("emmm,you can't find flag 23333");
      break;
  }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>case1是打印flag的关键</p>
<ul>
<li><p>f1已知：f1 = “GXY{do_not_”</p>
</li>
<li><p>f2未知，需要由case4和case5生成</p>
<p>case4应该是单次将字符串拷贝到f2</p>
<p>case则是对字符串进行解密，执行次数未知</p>
</li>
</ul>
<p>可以看到生成随机数只会有5次</p>
<p>那么这里直接考虑静态用算法爆破 </p>
<p>将字符串s按照case5的算法解密，直到输出的字符串像flag了就可以拼接起来。</p>
<h3 id="解密脚本"><a href="#解密脚本" class="headerlink" title="解密脚本"></a>解密脚本</h3><p>经过测试刚好只需要执行一次case5即可</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
char f2;
int main() {
    int j = 0;
    __int64 s = 0x7F666F6067756369LL;
    strcat(&amp;f2, (const char*)&amp;s);
    for (j = 0; j &lt;= 7; ++j)
    {
        if (j % 2 == 1)
            *(&amp;f2 + j) -= 2;
        else
            --* (&amp;f2 + j);
    }
    const char* f1 = "GXY{do_not_";
    puts("OK, it's flag:");
    memset(&amp;s, 0, 0x28uLL);
    strcat((char*)&amp;s, f1);
    char* temp = (char*)&amp;f2 + 9;
    *temp = '\0';
    strcat((char*)&amp;s, &amp;f2);
    printf("%s", (char*)&amp;s);
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>直接抄了伪代码 运行后还触发异常 栈崩溃了哈哈</p>
<p>python为了练习也写了一波 感谢兄弟姐妹的指导</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token string">'\x7ffo`guci'</span>
s <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token builtin">list</span><span class="token punctuation">.</span>reverse<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span>
        s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>
        s<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
s1 <span class="token operator">=</span> <span class="token string">'flag{do_not_'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s1 <span class="token operator">+</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="动态解法"><a href="#动态解法" class="headerlink" title="动态解法"></a>动态解法</h3><p>上面都把patch_me处理了，不动态解一波题说不过去啊。</p>
<p>用IDA远程调试程序</p>
<p>根据上面分析需要分别执行case4,case5,case1。</p>
<p>我采用的方法是修改rand函数产生的随机值，令其满足跳转条件。</p>
<p>所以可以选择在<code>0x400829</code>处下断点</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220422153143195.png" alt="image-20220422153143195"></p>
<p>如图在执行到400829时，我会将RAX的值依次改为4，5，1</p>
<p><img src="%E9%80%86%E5%90%91%E7%BB%83%E4%B9%A0%E8%AE%B0%E5%BD%95.assets/image-20220422153355294.png" alt="image-20220422153355294"></p>
<p>最后直接获取Flag</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220422153610943.png" alt="image-20220422153610943"></p>
<p>因为一共生成5次随机数 所以有2次不用管</p>
<p>不影响看Flag</p>
<h2 id="刮开有奖"><a href="#刮开有奖" class="headerlink" title="刮开有奖"></a>刮开有奖</h2><h3 id="整体逻辑"><a href="#整体逻辑" class="headerlink" title="整体逻辑"></a>整体逻辑</h3><p>题目要求输入长度为8</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">memset(input, 0, 0xFFFFu);
    GetDlgItemTextA(hDlg, 1000, input, 0xFFFF);
    if ( strlen(input) == 8 )
    {
      Table[0] = 'Z';
      Table[1] = 'J';
      Table[2] = 'S';
      Table[3] = 'E';
      Table[4] = 'C';
      Table[5] = 'a';
      Table[6] = 'N';
      Table[7] = 'H';
      Table[8] = '3';
      Table[9] = 'n';
      Table[10] = 'g';
      sub_4010F0(Table, 0, 10);
      memset(v9, 0, 0xFFFFu);
      v9[0] = input[5];
      v9[2] = input[7];
      v9[1] = input[6];
      check1 = (const char *)sub_401000(v9, strlen(v9));
      memset(v9, 0, 0xFFFFu);
      v9[1] = input[3];
      v9[0] = input[2];
      v9[2] = input[4];
      check2 = (const char *)sub_401000(v9, strlen(v9));
      if ( input[0] == Table[0] + 34
        &amp;&amp; input[1] == Table[4]
        &amp;&amp; 4 * input[2] - 141 == 3 * Table[2]
        &amp;&amp; input[3] / 4 == 2 * (Table[7] / 9)
        &amp;&amp; !strcmp(check1, "ak1w")
        &amp;&amp; !strcmp(check2, "V1Ax") )
      {
        MessageBoxA(hDlg, "U g3t 1T!", "@_@", 0);
      }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>逻辑如下</p>
<ul>
<li>通过<code>sub_4010F0</code>初始化Table</li>
<li>输入的第678个字符通过<code>sub_401000</code>生成校验值check1</li>
<li>输入的第345个字符通过<code>sub_401000</code>生成校验值check2</li>
<li>用初始化完毕的Table验证输入的1234位</li>
</ul>
<h3 id="sub-4010F0"><a href="#sub-4010F0" class="headerlink" title="sub_4010F0"></a>sub_4010F0</h3><p>sub_4010F0</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">Table[0] = 'Z';
Table[1] = 'J';
Table[2] = 'S';
Table[3] = 'E';
Table[4] = 'C';
Table[5] = 'a';
Table[6] = 'N';
Table[7] = 'H';
Table[8] = '3';
Table[9] = 'n';
Table[10] = 'g';
sub_4010F0(Table, 0, 10);

int __cdecl sub_4010F0(int a1, int a2, int a3)
{
  int result; // eax
  int i; // esi
  int v5; // ecx
  int v6; // edx

  result = a3;
  for ( i = a2; i &lt;= a3; a2 = i )
  {
    v5 = 4 * i;
    v6 = *(_DWORD *)(4 * i + a1);
    if ( a2 &lt; result &amp;&amp; i &lt; result )
    {
      do
      {
        if ( v6 &gt; *(_DWORD *)(a1 + 4 * result) )
        {
          if ( i &gt;= result )
            break;
          ++i;
          *(_DWORD *)(v5 + a1) = *(_DWORD *)(a1 + 4 * result);
          if ( i &gt;= result )
            break;
          while ( *(_DWORD *)(a1 + 4 * i) &lt;= v6 )
          {
            if ( ++i &gt;= result )
              goto LABEL_13;
          }
          if ( i &gt;= result )
            break;
          v5 = 4 * i;
          *(_DWORD *)(a1 + 4 * result) = *(_DWORD *)(4 * i + a1);
        }
        --result;
      }
      while ( i &lt; result );
    }
LABEL_13:
    *(_DWORD *)(a1 + 4 * result) = v6;
    sub_4010F0(a1, a2, i - 1);
    result = a3;
    ++i;
  }
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>大概是排序将Table从小到大排序</p>
<p>经过调试验证一下 Table的值分布如下</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220422203751398.png" alt="image-20220422203751398"></p>
<p>可见确实是排序</p>
<p><del>Table = ‘3JSECHNZang’</del></p>
<p>上面调试没跑完 后面重新跑了一下代码才对</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">#include &lt;stdio.h&gt;
#include &lt;Windows.h&gt;

#define _DWORD DWORD
int __cdecl sub_4010F0(int Table, int arg_0, int arg_10)
{
  int result; // eax
  int i; // esi
  int v5; // ecx
  int v6; // edx

  result = arg_10;
  for ( i = arg_0; i &lt;= arg_10; arg_0 = i )
  {
    v5 = 4 * i;
    v6 = *(_DWORD *)(4 * i + Table);
    if ( arg_0 &lt; result &amp;&amp; i &lt; result )
    {
      do
      {
        if ( v6 &gt; *(_DWORD *)(Table + 4 * result) )
        {
          if ( i &gt;= result )
            break;
          ++i;
          *(_DWORD *)(v5 + Table) = *(_DWORD *)(Table + 4 * result);// 后面小则覆盖前面的
          if ( i &gt;= result )
            break;
          while ( *(_DWORD *)(Table + 4 * i) &lt;= v6 )
          {
            if ( ++i &gt;= result )
              goto LABEL_13;
          }
          if ( i &gt;= result )
            break;
          v5 = 4 * i;
          *(_DWORD *)(Table + 4 * result) = *(_DWORD *)(4 * i + Table);
        }
        --result;                               // 从后往前找比index_value小的
      }
      while ( i &lt; result );
    }
LABEL_13:
    *(_DWORD *)(Table + 4 * result) = v6;
    sub_4010F0(Table, arg_0, i - 1);
    result = arg_10;
    ++i;
  }
  return result;
}

int main(){
    int Table[11];
    Table[0] = 'Z';
    Table[1] = 74;
    Table[2] = 83;
    Table[3] = 69;
    Table[4] = 67;
    Table[5] = 97;
    Table[6] = 78;
    Table[7] = 72;
    Table[8] = 51;
    Table[9] = 110;
    Table[10] = 103;
    sub_4010F0(Table, 0, 10);
    for(int i = 0; i &lt; 11; i++){
        printf("%c",Table[i]);
    }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>输出得Table = ‘3CEHJNSZagn’</p>
<h3 id="sub-401000"><a href="#sub-401000" class="headerlink" title="sub_401000"></a>sub_401000</h3><p>sub_401000</p>
<p>看起来非常复杂</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">_BYTE *__cdecl sub_401000(int input, int length)
{
  int value_1; // eax
  int index1; // esi
  size_t value_5; // ebx
  _BYTE *buffer1; // eax
  _BYTE *v6; // edi
  int length_v; // eax
  _BYTE *buffer2; // ebx
  int temp1; // edi
  int i1; // edx
  int num3; // edi
  int v12; // eax
  int i; // esi
  _BYTE *result; // eax
  _BYTE *v15; // [esp+Ch] [ebp-10h]
  _BYTE *buffer3; // [esp+10h] [ebp-Ch]
  int v17; // [esp+14h] [ebp-8h]
  int index2; // [esp+18h] [ebp-4h]

  value_1 = length / 3;
  index1 = 0;
  if ( length % 3 &gt; 0 )
    ++value_1;
  value_5 = 4 * value_1 + 1;
  buffer1 = malloc(value_5);
  v6 = buffer1;
  v15 = buffer1;
  if ( !buffer1 )
    exit(0);
  memset(buffer1, 0, value_5);
  length_v = length;
  buffer2 = v6;
  buffer3 = v6;
  if ( length &gt; 0 )
  {
    while ( 1 )
    {
      temp1 = 0;
      i1 = 0;
      index2 = 0;
      do
      {
        if ( index1 &gt;= length_v )
          break;
        ++i1;
        temp1 = *(unsigned __int8 *)(index1 + input) | (temp1 &lt;&lt; 8);
        ++index1;
      }
      while ( i1 &lt; 3 );                         // 执行3次
      num3 = temp1 &lt;&lt; (8 * (3 - i1));
      v12 = 0;
      v17 = index1;
      for ( i = 18; i &gt; -6; i -= 6 )
      {
        if ( i1 &gt;= v12 )
        {
          *((_BYTE *)&amp;index2 + v12) = (num3 &gt;&gt; i) &amp; 0x3F;
          buffer2 = buffer3;
        }
        else
        {
          *((_BYTE *)&amp;index2 + v12) = 64;
        }
        *buffer2++ = byte_407830[*((char *)&amp;index2 + v12++)];
        buffer3 = buffer2;
      }
      index1 = v17;
      if ( v17 &gt;= length )
        break;
      length_v = length;
    }
    v6 = v15;
  }
  result = v6;
  *buffer2 = 0;
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>解读到一半不想看了 去查了下攻略</p>
<p>发现大家先进入<code>byte_407830</code>查看，看到下表。</p>
<p>直接就认作是base64了，学习了。</p>
<p>同时又被提醒了一次 base64编码是每3个字节编码成4个字节</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220423140134949.png" alt="image-20220423140134949"></p>
<p>对check1和check2的比对值进行解码</p>
<p>得到Flag的345678位为<code>jMpWP1</code></p>
<p>再拼接一下前面两位就OK了</p>
<h3 id="解密脚本-1"><a href="#解密脚本-1" class="headerlink" title="解密脚本"></a>解密脚本</h3><p>比较逻辑</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">check1 = (const char *)sub_401000(v9, strlen(v9));// check1对应input[5+6+7]

check2 = (const char *)sub_401000(v9, strlen(v9));// check2对应input[2+3+4]
if ( input[0] == Table[0] + 34            // input[0]
  &amp;&amp; input[1] == Table[4]                 // input[1]
  &amp;&amp; 4 * input[2] - 141 == 3 * Table[2]
  &amp;&amp; input[3] / 4 == 2 * (Table[7] / 9)
  &amp;&amp; !strcmp(check1, "ak1w")
  &amp;&amp; !strcmp(check2,"V1Ax") )<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>对照比较逻辑写出解密脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    flag <span class="token operator">=</span> <span class="token string">''</span>
    Table <span class="token operator">=</span> <span class="token string">'3CEHJNSZagn'</span>
    check1 <span class="token operator">=</span> <span class="token string">'ak1w'</span>
    check2 <span class="token operator">=</span> <span class="token string">'V1Ax'</span>
    flag_check1 <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>check1<span class="token punctuation">)</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    flag_check2 <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>check2<span class="token punctuation">)</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>Table<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">34</span><span class="token punctuation">)</span>
    flag <span class="token operator">+=</span> Table<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag <span class="token operator">+</span> flag_check2 <span class="token operator">+</span> flag_check1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>总结：python牛逼</p>
<h2 id="ACTF新生赛2020-easyre"><a href="#ACTF新生赛2020-easyre" class="headerlink" title="[ACTF新生赛2020]easyre"></a>[ACTF新生赛2020]easyre</h2><h3 id="预先处理"><a href="#预先处理" class="headerlink" title="预先处理"></a>预先处理</h3><p>先脱掉UPX壳</p>
<p>查看主函数如下</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl main(int argc, const char **argv, const char **envp)
{
  _BYTE v4[12]; // [esp+12h] [ebp-2Eh] BYREF
  _DWORD v5[3]; // [esp+1Eh] [ebp-22h]
  _BYTE v6[5]; // [esp+2Ah] [ebp-16h] BYREF
  int v7; // [esp+2Fh] [ebp-11h]
  int v8; // [esp+33h] [ebp-Dh]
  int v9; // [esp+37h] [ebp-9h]
  char v10; // [esp+3Bh] [ebp-5h]
  int i; // [esp+3Ch] [ebp-4h]

  sub_401A10();
  qmemcpy(v4, "*F'\"N,\"(I?+@", sizeof(v4));
  printf("Please input:");
  scanf("%s", v6);
  if ( v6[0] != 65 || v6[1] != 67 || v6[2] != 84 || v6[3] != 70 || v6[4] != 123 || v10 != 125 )
    return 0;
  v5[0] = v7;
  v5[1] = v8;
  v5[2] = v9;
  for ( i = 0; i &lt;= 11; ++i )
  {
    if ( v4[i] != byte_402000[*((char *)v5 + i) - 1] )
      return 0;
  }
  printf("You are correct!");
  return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>注意这里的v10，乍一看不知道哪里改变了它的值。</p>
<p>其实是IDA进行scanf的v6识别是不准确的，被出题人混淆视听了。</p>
<p>需要自己手动改一下局部变量，以后遇到这种情况也可以用类似的方法思考。</p>
<h3 id="分析主函数"><a href="#分析主函数" class="headerlink" title="分析主函数"></a>分析主函数</h3><p>更改后再来看主函数逻辑如下</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl main(int argc, const char **argv, const char **envp)
{
  _BYTE v4[12]; // [esp+12h] [ebp-2Eh] BYREF
  _DWORD v5[3]; // [esp+1Eh] [ebp-22h]
  _BYTE input[18]; // [esp+2Ah] [ebp-16h] BYREF
  int i; // [esp+3Ch] [ebp-4h]

  sub_401A10();
  qmemcpy(v4, "*F'\"N,\"(I?+@", sizeof(v4));
  printf("Please input:");
  scanf("%s", input);
  if ( input[0] != 'A' || input[1] != 'C' || input[2] != 'T' || input[3] != 'F' || input[4] != '{' || input[17] != '}' )
    return 0;
  v5[0] = *(_DWORD *)&amp;input[5];
  v5[1] = *(_DWORD *)&amp;input[9];
  v5[2] = *(_DWORD *)&amp;input[13];
  for ( i = 0; i &lt;= 11; ++i )
  {
    if ( v4[i] != byte_402000[*((char *)v5 + i) - 1] )
      return 0;
  }
  printf("You are correct!");
  return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看到逻辑是通过输入12位，与<code>byte_402000</code>进行比对。</p>
<p>所以可以写出解密脚本</p>
<h3 id="Dump字符串"><a href="#Dump字符串" class="headerlink" title="Dump字符串"></a>Dump字符串</h3><p>需要对<code>byte_402000</code>的内容进行提取，IDA自带的不太好看。</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220424170012732.png" alt="image-20220424170012732"></p>
<p>于是我们可以写个简单的python脚本提取一下该区段的内容</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> idc
begin <span class="token operator">=</span> <span class="token number">0x402000</span>  
end <span class="token operator">=</span> <span class="token number">0x40205F</span>   
size <span class="token operator">=</span> end <span class="token operator">-</span> begin
<span class="token keyword">print</span><span class="token punctuation">(</span>get_bytes<span class="token punctuation">(</span>begin<span class="token punctuation">,</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>直接得到可以复制的字符串带进python，非常方便。</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220424170155160.png" alt="image-20220424170155160"></p>
<h3 id="解密脚本-2"><a href="#解密脚本-2" class="headerlink" title="解密脚本"></a>解密脚本</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">byte_402000 <span class="token operator">=</span> <span class="token string">b'~}|{zyxwvutsrqponmlkjihgfedcba`_^]\\[ZYXWVUTSRQPONMLKJIHGFEDCBA@?&gt;=&lt;;:9876543210/.-,+*)(\'&amp;%$# !"\x00'</span>
<span class="token keyword">def</span> <span class="token function">look</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>byte_402000<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> a <span class="token operator">==</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>byte_402000<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            temp <span class="token operator">=</span> i
            <span class="token keyword">return</span> temp<span class="token punctuation">;</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    v4 <span class="token operator">=</span> <span class="token string">"*F'\"N,\"(I?+@"</span>
    v5 <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        v5 <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>look<span class="token punctuation">(</span>v4<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里还遇到一个小坑</p>
<p>注意第4排, <code>byte_402000[i]</code>的类型是<code>int</code>类型，直接和<code>char</code>类型比较是找不到的。</p>
<p>所以一开始函数返回结果类型是<code>nonetype</code>，把我搞懵了好一会儿。</p>
<h2 id="ACTF新生赛2020-rome"><a href="#ACTF新生赛2020-rome" class="headerlink" title="[ACTF新生赛2020]rome"></a>[ACTF新生赛2020]rome</h2><h3 id="关键逻辑"><a href="#关键逻辑" class="headerlink" title="关键逻辑"></a>关键逻辑</h3><p>输入为22位</p>
<p>砍掉ACTF{}的6位还剩16位</p>
<p>被按顺序分配到v1数组中处理</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">v1[0] = *(_DWORD *)&amp;input[5];
v1[1] = *(_DWORD *)&amp;input[9];
v1[2] = *(_DWORD *)&amp;input[13];
v1[3] = *(_DWORD *)&amp;input[17];
for ( i = 0; i &lt;= 15; ++i )
{
    if ( *((char *)v1 + i) &gt; '@' &amp;&amp; *((char *)v1 + i) &lt;= 'Z' )
        *((_BYTE *)v1 + i) = (*((char *)v1 + i) - 51) % 26 + 65;
    if ( *((char *)v1 + i) &gt; '`' &amp;&amp; *((char *)v1 + i) &lt;= 'z' )
        *((_BYTE *)v1 + i) = (*((char *)v1 + i) - 79) % 26 + 97;
}
for ( i = 0; i &lt;= 15; ++i )
{
    result = (unsigned __int8)array[i];
    if ( *((_BYTE *)v1 + i) != (_BYTE)result )
        return result;
}
result = printf("You are correct!");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h3 id="解密脚本-3"><a href="#解密脚本-3" class="headerlink" title="解密脚本"></a>解密脚本</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">array <span class="token operator">=</span> <span class="token string">"Qsw3sj_lz4_Ujw@l"</span>
flag <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">def</span> <span class="token function">daxie</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> a <span class="token operator">&lt;</span> <span class="token string">'A'</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">26</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> a <span class="token operator">&gt;</span> <span class="token string">'Z'</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">26</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> a
<span class="token keyword">def</span> <span class="token function">xiaoxie</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> a <span class="token operator">&lt;</span> <span class="token string">'a'</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">26</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> a <span class="token operator">&gt;</span> <span class="token string">'z'</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">26</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> a
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token string">'Z'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">65</span><span class="token punctuation">)</span>
        temp <span class="token operator">=</span> daxie<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">51</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        flag <span class="token operator">+=</span> temp
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;=</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;=</span> <span class="token string">'z'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">97</span><span class="token punctuation">)</span>
        temp <span class="token operator">=</span> xiaoxie<span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">79</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        flag <span class="token operator">+=</span> temp
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> array<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="CrackRTF（好评）"><a href="#CrackRTF（好评）" class="headerlink" title="CrackRTF（好评）"></a>CrackRTF（好评）</h2><h3 id="主逻辑"><a href="#主逻辑" class="headerlink" title="主逻辑"></a>主逻辑</h3><pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl main_0(int argc, const char **argv, const char **envp)
{
  DWORD length; // eax
  DWORD v4; // eax
  char Str[260]; // [esp+4Ch] [ebp-310h] BYREF
  int v7; // [esp+150h] [ebp-20Ch]
  char String1[260]; // [esp+154h] [ebp-208h] BYREF
  char Destination[260]; // [esp+258h] [ebp-104h] BYREF

  memset(Destination, 0, sizeof(Destination));
  memset(String1, 0, sizeof(String1));
  v7 = 0;
  printf("pls input the first passwd(1): ");
  scanf("%s", Destination);
  if ( strlen(Destination) != 6 )
  {
    printf("Must be 6 characters!\n");
    ExitProcess(0);
  }
  v7 = atoi(Destination);
  if ( v7 &lt; 100000 )
    ExitProcess(0);
  strcat(Destination, "@DBApp");
  length = strlen(Destination);
  sub_40100A((BYTE *)Destination, length, String1);
  if ( !_strcmpi(String1, "6E32D0943418C2C33385BC35A1470250DD8923A9") )
  {
    printf("continue...\n\n");
    printf("pls input the first passwd(2): ");
    memset(Str, 0, sizeof(Str));
    scanf("%s", Str);
    if ( strlen(Str) != 6 )
    {
      printf("Must be 6 characters!\n");
      ExitProcess(0);
    }
    strcat(Str, Destination);
    memset(String1, 0, sizeof(String1));
    v4 = strlen(Str);
    sub_401019((BYTE *)Str, v4, String1);
    if ( !_strcmpi("27019e688a4e62a649fd99cadaafdb4e", String1) )
    {
      if ( !(unsigned __int8)sub_40100F(Str) )
      {
        printf("Error!!\n");
        ExitProcess(0);
      }
      printf("bye ~~\n");
    }
  }
  return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>大致逻辑如下</p>
<ul>
<li><p>先输入六个字符</p>
<p>之后进行拼接</p>
<p><code>sub_40100A</code>做操作进行校验</p>
</li>
<li><p>通过后再次要求输入六个字符</p>
<p>进行拼接</p>
<p><code>sub_401019</code>做操作后进行校验</p>
</li>
<li><p>最后通过<code>sub_40100F</code>校验一下</p>
</li>
</ul>
<h3 id="第一段验证"><a href="#第一段验证" class="headerlink" title="第一段验证"></a>第一段验证</h3><pre class="line-numbers language-C" data-language="C"><code class="language-C">v7 = atoi(Destination);
if ( v7 &lt; 100000 )
  ExitProcess(0);
strcat(Destination, "@DBApp");
length = strlen(Destination);
sub_40100A((BYTE *)Destination, length, String1);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>推断第一次输入为6个数字且 100000 &lt;= v7 &lt;= 999999</p>
<p>数字和”@DBApp”拼接后</p>
<p>进入<code>sub_40100A</code>查看</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">int</span> __cdecl sub_40100A<span class="token punctuation">(</span>BYTE <span class="token operator">*</span>pbData<span class="token punctuation">,</span> DWORD dwDataLen<span class="token punctuation">,</span> LPSTR lpString1<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">return</span> sub_401230<span class="token punctuation">(</span>pbData<span class="token punctuation">,</span> dwDataLen<span class="token punctuation">,</span> lpString1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>进入<code>sub_401230</code>查看</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">sub_401230</span><span class="token punctuation">(</span>BYTE <span class="token operator">*</span>pbData<span class="token punctuation">,</span> DWORD dwDataLen<span class="token punctuation">,</span> LPSTR lpString1<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">int</span> result<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  DWORD i<span class="token punctuation">;</span> <span class="token comment">// [esp+4Ch] [ebp-28h]</span>
  CHAR String2<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+50h] [ebp-24h] BYREF</span>
  BYTE v6<span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [esp+54h] [ebp-20h] BYREF</span>
  DWORD pdwDataLen<span class="token punctuation">;</span> <span class="token comment">// [esp+68h] [ebp-Ch] BYREF</span>
  HCRYPTHASH phHash<span class="token punctuation">;</span> <span class="token comment">// [esp+6Ch] [ebp-8h] BYREF</span>
  HCRYPTPROV phProv<span class="token punctuation">;</span> <span class="token comment">// [esp+70h] [ebp-4h] BYREF</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">CryptAcquireContextA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>phProv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1u</span><span class="token punctuation">,</span> <span class="token number">0xF0000000</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">CryptCreateHash</span><span class="token punctuation">(</span>phProv<span class="token punctuation">,</span> <span class="token number">0x8004u</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>phHash<span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">CryptHashData</span><span class="token punctuation">(</span>phHash<span class="token punctuation">,</span> pbData<span class="token punctuation">,</span> dwDataLen<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token function">CryptGetHashParam</span><span class="token punctuation">(</span>phHash<span class="token punctuation">,</span> <span class="token number">2u</span><span class="token punctuation">,</span> v6<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pdwDataLen<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token operator">*</span>lpString1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> pdwDataLen<span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">wsprintfA</span><span class="token punctuation">(</span>String2<span class="token punctuation">,</span> <span class="token string">"%02X"</span><span class="token punctuation">,</span> v6<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lstrcatA</span><span class="token punctuation">(</span>lpString1<span class="token punctuation">,</span> String2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">CryptDestroyHash</span><span class="token punctuation">(</span>phHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">CryptReleaseContext</span><span class="token punctuation">(</span>phProv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      <span class="token function">CryptDestroyHash</span><span class="token punctuation">(</span>phHash<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">CryptReleaseContext</span><span class="token punctuation">(</span>phProv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">{</span>
    <span class="token function">CryptReleaseContext</span><span class="token punctuation">(</span>phProv<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现是哈希算法</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220427154653032.png" alt="image-20220427154653032"></p>
<p>通过CreateHash去查询使用了什么哈希算法</p>
<p><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id">ALG_ID （Wincrypt.h） - Win32 应用|微软文档 (microsoft.com)</a></p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220427154946603.png" alt="image-20220427154946603"></p>
<p>发现是SHA1</p>
<p>也就是将<code>xxxxxx@DBApp</code>生成SHA1等于<code>6E32D0943418C2C33385BC35A1470250DD8923A9</code></p>
<p>需要进行碰撞攻击</p>
<h3 id="第二段验证"><a href="#第二段验证" class="headerlink" title="第二段验证"></a>第二段验证</h3><p>同样是输入6个字符但这次并没有限制数字了，将之前的输入拼接到这次输入的后面，带入<code>sub_401019</code>。</p>
<p>这次也是哈希算法，ALG_ID为<code>0x8003</code></p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220427160333599.png" alt="image-20220427160333599"></p>
<p>这次使用的是MD5</p>
<p>也就是加入18的位字符串</p>
<p>要求生成的MD5值为<code>27019e688a4e62a649fd99cadaafdb4e</code>。</p>
<p>这种不太好攻击，再看最后的验证</p>
<h3 id="最后验证"><a href="#最后验证" class="headerlink" title="最后验证"></a>最后验证</h3><p>验证拼接的18位字符</p>
<p><code>xxxxxxxxxxxx@DBApp</code></p>
<p>算法如下，返回1代表通过验证：</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">char __cdecl sub_4014D0(LPCSTR lpString)
{
  LPCVOID lpBuffer; // [esp+50h] [ebp-1Ch]
  DWORD NumberOfBytesWritten; // [esp+58h] [ebp-14h] BYREF
  DWORD nNumberOfBytesToWrite; // [esp+5Ch] [ebp-10h]
  HGLOBAL hResData; // [esp+60h] [ebp-Ch]
  HRSRC hResInfo; // [esp+64h] [ebp-8h]
  HANDLE hFile; // [esp+68h] [ebp-4h]

  hFile = 0;
  hResData = 0;
  nNumberOfBytesToWrite = 0;
  NumberOfBytesWritten = 0;
  hResInfo = FindResourceA(0, (LPCSTR)0x65, "AAA");
  if ( !hResInfo )
    return 0;
  nNumberOfBytesToWrite = SizeofResource(0, hResInfo);
  hResData = LoadResource(0, hResInfo);
  if ( !hResData )
    return 0;
  lpBuffer = LockResource(hResData);
  sub_401005(lpString, (int)lpBuffer, nNumberOfBytesToWrite);
  hFile = CreateFileA("dbapp.rtf", 0x10000000u, 0, 0, 2u, 0x80u, 0);
  if ( hFile == (HANDLE)-1 )
    return 0;
  if ( !WriteFile(hFile, lpBuffer, nNumberOfBytesToWrite, &amp;NumberOfBytesWritten, 0) )
    return 0;
  CloseHandle(hFile);
  return 1;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现这是一个生成Flag文件的函数</p>
<p>要求就是用户之前的输入正确，再提取程序中的AAA资源文件。</p>
<p>将两者再通过算法搅在一起，最后生成正确的Flag文件。</p>
<p>看看处理函数<code>sub_401005</code>，指向<code>sub_401420</code></p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">unsigned int __cdecl sub_401420(LPCSTR input, int resfile, int length_res)
{
  unsigned int result; // eax
  unsigned int i; // [esp+4Ch] [ebp-Ch]
  unsigned int length_input; // [esp+54h] [ebp-4h]

  length_input = lstrlenA(input);
  for ( i = 0; ; ++i )
  {
    result = i;
    if ( i &gt;= length_res )
      break;
    *(_BYTE *)(i + resfile) ^= input[i % length_input];
  }
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>简单的用输入的18位 对 文件内容 按位异或</p>
<p>要解密文件，那我们必须要前六位的内容</p>
<p>于是可以猜测文件遵循RTF格式的文件头，那么前六位应当是固定的。</p>
<p>再利用资源文件可以逆向计算出前六位的输入</p>
<p>而RTF标准的前六位格式如图</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220427165632426.png" alt="image-20220427165632426"></p>
<p>由字符串``{\rtf1`构成</p>
<p>于是通过python脚本计算一下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">str1 <span class="token operator">=</span> <span class="token string">r"{\rtf1"</span>
flag1 <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'AAA101'</span><span class="token punctuation">,</span><span class="token string">'rb+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        flag1 <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>str1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>得到该6位为<code>~!3a@0</code></p>
<h3 id="解密脚本-4"><a href="#解密脚本-4" class="headerlink" title="解密脚本"></a>解密脚本</h3><p>分为两段</p>
<p>前6位通过文件头解密</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">str1 <span class="token operator">=</span> <span class="token string">r"{\rtf1"</span>
flag1 <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'AAA101'</span><span class="token punctuation">,</span><span class="token string">'rb+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>str1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        flag1 <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>str1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> f<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>后6位通过sha1爆破解密</p>
<p>得结果为<code>~!3a@0123321@DBApp</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> hashlib
<span class="token comment">#6E32D0943418C2C33385BC35A1470250DD8923A9</span>
dest <span class="token operator">=</span> <span class="token string">'6E32D0943418C2C33385BC35A1470250DD8923A9'</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">,</span> <span class="token number">999999</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    str1 <span class="token operator">=</span> <span class="token string">b'@DBApp'</span>
    temp <span class="token operator">=</span> hashlib<span class="token punctuation">.</span>sha1<span class="token punctuation">(</span><span class="token builtin">bytes</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> str1<span class="token punctuation">)</span>
    temp <span class="token operator">=</span> temp<span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
    <span class="token keyword">if</span> temp <span class="token operator">==</span> dest<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> str1<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后加上6位固定字符串<code>@DBApp</code></p>
<p>即可得到18位的flag</p>
<p>拼凑后为<code>~!3a@0123321@DBApp</code></p>
<h3 id="测试结果"><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h3><p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220427171933374.png" alt="image-20220427171933374"></p>
<p>可以看到已经触发了生成Flag文件的逻辑，猜想正确。</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220427171958079.png" alt="image-20220427171958079"></p>
<p>也成功拿到Flag</p>
<h2 id="2019红帽杯-easyRE（好评）"><a href="#2019红帽杯-easyRE（好评）" class="headerlink" title="[2019红帽杯]easyRE（好评）"></a>[2019红帽杯]easyRE（好评）</h2><h3 id="第一次上当"><a href="#第一次上当" class="headerlink" title="第一次上当"></a>第一次上当</h3><h4 id="主要逻辑"><a href="#主要逻辑" class="headerlink" title="主要逻辑"></a>主要逻辑</h4><p>这题没符号，不知道能不能恢复，下来查一波。</p>
<p>带着耐心猜测辨认一下哪些是系统函数。</p>
<p>通过找字符串定位<code>sub_4009C6</code></p>
<p>随便命名了一波 大致如下</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 <span class="token function">sub_4009C6</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  __int64 result<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-114h]</span>
  __int64 v2<span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-110h]</span>
  __int64 v3<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-108h]</span>
  __int64 v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-100h]</span>
  __int64 v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+28h] [rbp-F8h]</span>
  __int64 v6<span class="token punctuation">;</span> <span class="token comment">// [rsp+30h] [rbp-F0h]</span>
  __int64 v7<span class="token punctuation">;</span> <span class="token comment">// [rsp+38h] [rbp-E8h]</span>
  __int64 v8<span class="token punctuation">;</span> <span class="token comment">// [rsp+40h] [rbp-E0h]</span>
  __int64 v9<span class="token punctuation">;</span> <span class="token comment">// [rsp+48h] [rbp-D8h]</span>
  __int64 v10<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-D0h]</span>
  __int64 v11<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-C8h]</span>
  <span class="token keyword">char</span> v12<span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+60h] [rbp-C0h] BYREF</span>
  <span class="token keyword">char</span> input<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+90h] [rbp-90h] BYREF</span>
  <span class="token keyword">int</span> v14<span class="token punctuation">;</span> <span class="token comment">// [rsp+B0h] [rbp-70h]</span>
  <span class="token keyword">char</span> v15<span class="token punctuation">;</span> <span class="token comment">// [rsp+B4h] [rbp-6Ch]</span>
  <span class="token keyword">char</span> v16<span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+C0h] [rbp-60h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v17<span class="token punctuation">;</span> <span class="token comment">// [rsp+108h] [rbp-18h]</span>

  v17 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">qmemcpy</span><span class="token punctuation">(</span>v12<span class="token punctuation">,</span> <span class="token string">"Iodl&gt;Qnb(ocy\x7Fy.i\x7Fd`3w}wek9{iy=~yL@EC"</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v14 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  v15 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token function">Sysread</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> input<span class="token punctuation">,</span> <span class="token number">37uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v15 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">length</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">36</span> <span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token function">length</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8<span class="token punctuation">)</span><span class="token punctuation">(</span>input<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> v12<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        result <span class="token operator">=</span> <span class="token number">4294967294LL</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_13<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token string">"continue!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memset</span><span class="token punctuation">(</span>v16<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">64uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v16<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">Sysread</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> v16<span class="token punctuation">,</span> <span class="token number">64uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v16<span class="token punctuation">[</span><span class="token number">39</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">length</span><span class="token punctuation">(</span>v16<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">39</span> <span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
      v2 <span class="token operator">=</span> <span class="token function">base64</span><span class="token punctuation">(</span>v16<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v3 <span class="token operator">=</span> <span class="token function">base64</span><span class="token punctuation">(</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v4 <span class="token operator">=</span> <span class="token function">base64</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v5 <span class="token operator">=</span> <span class="token function">base64</span><span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v6 <span class="token operator">=</span> <span class="token function">base64</span><span class="token punctuation">(</span>v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v7 <span class="token operator">=</span> <span class="token function">base64</span><span class="token punctuation">(</span>v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v8 <span class="token operator">=</span> <span class="token function">base64</span><span class="token punctuation">(</span>v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v9 <span class="token operator">=</span> <span class="token function">base64</span><span class="token punctuation">(</span>v8<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v10 <span class="token operator">=</span> <span class="token function">base64</span><span class="token punctuation">(</span>v9<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v11 <span class="token operator">=</span> <span class="token function">base64</span><span class="token punctuation">(</span>v10<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">sub_400360</span><span class="token punctuation">(</span>v11<span class="token punctuation">,</span> off_6CC090<span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token string">"You found me!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token string">"bye bye~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      result <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{</span>
      result <span class="token operator">=</span> <span class="token number">4294967293LL</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">{</span>
    result <span class="token operator">=</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
LABEL_13<span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span> <span class="token operator">!=</span> v17 <span class="token punctuation">)</span>
    <span class="token function">sub_444020</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p>一阶段输入长度36的字符串</p>
<p>通过异或计算和v12数组比较</p>
<p>比对成功后进入二阶段</p>
</li>
<li><p>二阶段输入长度为39</p>
<p>猜测进行了疯狂的base64操作</p>
<p>最后进行比对</p>
</li>
</ul>
<h4 id="一阶段"><a href="#一阶段" class="headerlink" title="一阶段"></a>一阶段</h4><p>通过脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">p1 <span class="token operator">=</span> <span class="token string">'Iodl&gt;Qnb(ocy\x7Fy.i\x7Fd`3w}wek9{iy=~yL@EC'</span>
flag1 <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag1 <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>p1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> i<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag1<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>获得一阶段输入为</p>
<pre class="line-numbers language-none"><code class="language-none">Info:The first four chars are `flag`<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>这既是输入也是对我们的提示，有点小巧妙。</p>
<h4 id="二阶段"><a href="#二阶段" class="headerlink" title="二阶段"></a>二阶段</h4><p>最开始还没看明白为啥这么多base64</p>
<p>后面看到的超长字符串 才意识到可能是进行了多次base64编码</p>
<p>将最后比对的字符串导出</p>
<p>进行解密</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">p2 <span class="token operator">=</span> <span class="token string">b'Vm0wd2VHUXhTWGhpUm1SWVYwZDRWVll3Wkc5WFJsbDNXa1pPVlUxV2NIcFhhMk0xVmpKS1NHVkdXbFpOYmtKVVZtcEtTMUl5VGtsaVJtUk9ZV3hhZVZadGVHdFRNVTVYVW01T2FGSnRVbGhhVjNoaFZWWmtWMXBFVWxSTmJFcElWbTAxVDJGV1NuTlhia0pXWWxob1dGUnJXbXRXTVZaeVdrWm9hVlpyV1hwV1IzaGhXVmRHVjFOdVVsWmlhMHBZV1ZSR1lWZEdVbFZTYlhSWFRWWndNRlZ0TVc5VWJGcFZWbXR3VjJKSFVYZFdha1pXWlZaT2NtRkhhRk5pVjJoWVYxZDBhMVV3TlhOalJscFlZbGhTY1ZsclduZGxiR1J5VmxSR1ZXSlZjRWhaTUZKaFZqSktWVkZZYUZkV1JWcFlWV3BHYTFkWFRrZFRiV3hvVFVoQ1dsWXhaRFJpTWtsM1RVaG9hbEpYYUhOVmJUVkRZekZhY1ZKcmRGTk5Wa3A2VjJ0U1ExWlhTbFpqUldoYVRVWndkbFpxUmtwbGJVWklZVVprYUdFeGNHOVhXSEJIWkRGS2RGSnJhR2hTYXpWdlZGVm9RMlJzV25STldHUlZUVlpXTlZadE5VOVdiVXBJVld4c1dtSllUWGhXTUZwell6RmFkRkpzVWxOaVNFSktWa1phVTFFeFduUlRhMlJxVWxad1YxWnRlRXRXTVZaSFVsUnNVVlZVTURrPQ=='</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p2 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>p2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>得到字符串</p>
<pre class="line-numbers language-none"><code class="language-none">https://bbs.pediy.com/thread-254172.htm<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h4 id="解密脚本-5"><a href="#解密脚本-5" class="headerlink" title="解密脚本"></a>解密脚本</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64

p1 <span class="token operator">=</span> <span class="token string">'Iodl&gt;Qnb(ocy\x7Fy.i\x7Fd`3w}wek9{iy=~yL@EC'</span>
flag1 <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag1 <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>p1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> i<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag1<span class="token punctuation">)</span>

p2 <span class="token operator">=</span> <span class="token string">b'Vm0wd2VHUXhTWGhpUm1SWVYwZDRWVll3Wkc5WFJsbDNXa1pPVlUxV2NIcFhhMk0xVmpKS1NHVkdXbFpOYmtKVVZtcEtTMUl5VGtsaVJtUk9ZV3hhZVZadGVHdFRNVTVYVW01T2FGSnRVbGhhVjNoaFZWWmtWMXBFVWxSTmJFcElWbTAxVDJGV1NuTlhia0pXWWxob1dGUnJXbXRXTVZaeVdrWm9hVlpyV1hwV1IzaGhXVmRHVjFOdVVsWmlhMHBZV1ZSR1lWZEdVbFZTYlhSWFRWWndNRlZ0TVc5VWJGcFZWbXR3VjJKSFVYZFdha1pXWlZaT2NtRkhhRk5pVjJoWVYxZDBhMVV3TlhOalJscFlZbGhTY1ZsclduZGxiR1J5VmxSR1ZXSlZjRWhaTUZKaFZqSktWVkZZYUZkV1JWcFlWV3BHYTFkWFRrZFRiV3hvVFVoQ1dsWXhaRFJpTWtsM1RVaG9hbEpYYUhOVmJUVkRZekZhY1ZKcmRGTk5Wa3A2VjJ0U1ExWlhTbFpqUldoYVRVWndkbFpxUmtwbGJVWklZVVprYUdFeGNHOVhXSEJIWkRGS2RGSnJhR2hTYXpWdlZGVm9RMlJzV25STldHUlZUVlpXTlZadE5VOVdiVXBJVld4c1dtSllUWGhXTUZwell6RmFkRkpzVWxOaVNFSktWa1phVTFFeFduUlRhMlJxVWxad1YxWnRlRXRXTVZaSFVsUnNVVlZVTURrPQ=='</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p2 <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>p2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h4 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h4><p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220428143139081.png" alt="image-20220428143139081"></p>
<p>那么现在我想问</p>
<p>flag是啥呢？</p>
<p>去细读了一下文章</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220428144044261.png" alt="image-20220428144044261"></p>
<p>玩几把蛋，看来走错路了。</p>
<h3 id="研究恢复符号"><a href="#研究恢复符号" class="headerlink" title="研究恢复符号"></a>研究恢复符号</h3><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/4484">利用FLIRT恢复静态编译程序的符号 - 先知社区 (aliyun.com)</a></p>
<p>[<a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-217790.htm">转帖]分析静态编译加剥离的ELF文件的一些方法-软件逆向-看雪论坛-安全社区|安全招聘|bbs.pediy.com</a></p>
<p>IDA中提供了一个东西做FLIRT：库文件快速识别与鉴定技术（Fast Library Identification and Recognition Technology）</p>
<p>简单的说，这玩意，能通过一个静态链接库的签名文件，来快速识别被去符号的程序中的函数，从而为函数找到符号</p>
<p>lscan走起 看看把哪些库导入一波</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220428153509080.png" alt="image-20220428153509080"></p>
<pre class="line-numbers language-none"><code class="language-none">No symbol table found bin binary
i386/sig/libcrypto-1.0.1e.sig 12694/4896 (259.27%)
i386/sig/libc-2.23.sig 5797/2862 (202.55%)
i386/sig/libglib2-2.44.sig 5745/2133 (269.34%)
i386/sig/libm-2.23.sig 5849/484 (1208.47%)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在IDA应用了没卵子用啊</p>
<p>下次遇到再试试 还得省点时间看论文呢</p>
<p>这波直接查了一波攻略</p>
<h3 id="再接再厉"><a href="#再接再厉" class="headerlink" title="再接再厉"></a>再接再厉</h3><h4 id="探索思路"><a href="#探索思路" class="headerlink" title="探索思路"></a>探索思路</h4><p>直接查了一波攻略</p>
<p>发现是在数据段下面还有一些数据</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220428161459834.png" alt="image-20220428161459834"></p>
<p>发现被函数<code>sub_400D35</code>引用</p>
<p>这个函数其实也是题目Flag真正的出处（真得脑洞大开）</p>
<p>看来以后还是得多注意数据段的东西，关键突破口！</p>
<p>进入该函数分析</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">unsigned __int64 sub_400D35()
{
  unsigned __int64 result; // rax
  unsigned int v1; // [rsp+Ch] [rbp-24h]
  int i; // [rsp+10h] [rbp-20h]
  int j; // [rsp+14h] [rbp-1Ch]
  unsigned int v4; // [rsp+24h] [rbp-Ch]
  unsigned __int64 v5; // [rsp+28h] [rbp-8h]

  v5 = __readfsqword(0x28u);
  v1 = sub_43FD20(0LL) - qword_6CEE38;
  for ( i = 0; i &lt;= 1233; ++i )
  {
    sub_40F790(v1);
    sub_40FE60();
    sub_40FE60();
    v1 = sub_40FE60() ^ 0x98765432;
  }
  v4 = v1;
  if ( ((unsigned __int8)v1 ^ byte_6CC0A0[0]) == 'f' &amp;&amp; (HIBYTE(v4) ^ (unsigned __int8)byte_6CC0A3) == 'g' )
  {
    for ( j = 0; j &lt;= 24; ++j )
      sub_410E90((unsigned __int8)(byte_6CC0A0[j] ^ *((_BYTE *)&amp;v4 + j % 4)));
  }
  result = __readfsqword(0x28u) ^ v5;
  if ( result )
    sub_444020();
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>v1和v4大概是产生随机数，别管</p>
<p>直接看20行的异或判断，我们可以逆推出v1的低8位和v4的高8位的值</p>
<p>但这还不够，结合前面的INFO告诉我们前四位为flag</p>
<p>那刚好是四个四节，所以我们先通过<code>byte_6CC0A0</code>的前面4个字节得到v4，再用v4开始解密<code>byte_6CC0A0</code></p>
<h4 id="解密脚本-6"><a href="#解密脚本-6" class="headerlink" title="解密脚本"></a>解密脚本</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python">array <span class="token operator">=</span> <span class="token string">'@5 V]\x18"E\x17/$nb&lt;\'THl$nr&lt;2E['</span>
key <span class="token operator">=</span> <span class="token string">''</span>
info <span class="token operator">=</span> <span class="token string">'flag'</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    key <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>info<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"key:"</span> <span class="token operator">+</span> key<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>key<span class="token punctuation">[</span>i <span class="token operator">%</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后终于拿到Flag</p>
<p>非常感动 真的是很有意思的一道题</p>
<h2 id="GUET-CTF2019-re"><a href="#GUET-CTF2019-re" class="headerlink" title="[GUET-CTF2019]re"></a>[GUET-CTF2019]re</h2><h3 id="脱壳"><a href="#脱壳" class="headerlink" title="脱壳"></a>脱壳</h3><p>发现是UPX壳，脱一下进IDA分析。</p>
<p><img src="%E9%80%86%E5%90%91%E7%BB%83%E4%B9%A0%E8%AE%B0%E5%BD%95.assets/image-20220429135544845.png" alt="image-20220429135544845"></p>
<h3 id="分析过程"><a href="#分析过程" class="headerlink" title="分析过程"></a>分析过程</h3><p>再次尝试恢复符号失败</p>
<p>玛德还是直接硬上吧</p>
<p>主要逻辑</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">printXB((unsigned int)"input your flag:", a2, a3, a4, a5, a6, 0LL, 0LL, 0LL, 0LL);
scanfXB((unsigned int)"%s", (unsigned int)&amp;input, v6, v7, v8, v9, input);
if ( (unsigned int)sub_4009AE(&amp;input) )
  sub_410350("Correct!");
else
  sub_410350("Wrong!");
result = 0LL;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>接下来看看<code>sub_4009AE</code></p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">_BOOL8 __fastcall sub_4009AE(char *a1)
{
  if ( 1629056 * *a1 != 166163712 )
    return 0LL;
  if ( 6771600 * a1[1] != 731332800 )
    return 0LL;
  if ( 3682944 * a1[2] != 357245568 )
    return 0LL;
  if ( 10431000 * a1[3] != 1074393000 )
    return 0LL;
  if ( 3977328 * a1[4] != 489211344 )
    return 0LL;
  if ( 5138336 * a1[5] != 518971936 )
    return 0LL;
  if ( 7532250 * a1[7] != 406741500 )
    return 0LL;
  if ( 5551632 * a1[8] != 294236496 )
    return 0LL;
  if ( 3409728 * a1[9] != 177305856 )
    return 0LL;
  if ( 13013670 * a1[10] != 650683500 )
    return 0LL;
  if ( 6088797 * a1[11] != 298351053 )
    return 0LL;
  if ( 7884663 * a1[12] != 386348487 )
    return 0LL;
  if ( 8944053 * a1[13] != 438258597 )
    return 0LL;
  if ( 5198490 * a1[14] != 249527520 )
    return 0LL;
  if ( 4544518 * a1[15] != 445362764 )
    return 0LL;
  if ( 3645600 * a1[17] != 174988800 )
    return 0LL;
  if ( 10115280 * a1[16] != 981182160 )
    return 0LL;
  if ( 9667504 * a1[18] != 493042704 )
    return 0LL;
  if ( 5364450 * a1[19] != 257493600 )
    return 0LL;
  if ( 13464540 * a1[20] != 767478780 )
    return 0LL;
  if ( 5488432 * a1[21] != 312840624 )
    return 0LL;
  if ( 14479500 * a1[22] != 1404511500 )
    return 0LL;
  if ( 6451830 * a1[23] != 316139670 )
    return 0LL;
  if ( 6252576 * a1[24] != 619005024 )
    return 0LL;
  if ( 7763364 * a1[25] != 372641472 )
    return 0LL;
  if ( 7327320 * a1[26] != 373693320 )
    return 0LL;
  if ( 8741520 * a1[27] != 498266640 )
    return 0LL;
  if ( 8871876 * a1[28] != 452465676 )
    return 0LL;
  if ( 4086720 * a1[29] != 208422720 )
    return 0LL;
  if ( 9374400 * a1[30] == 515592000 )
    return 5759124 * a1[31] == 719890500;
  return 0LL;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>好家伙</p>
<p>真就一个一个比对</p>
<p>那就搞</p>
<p>注意中间换了一次顺序</p>
<p>还有第6位没给 需要爆破 </p>
<p>傻逼题 就很没有营养 浪费时间</p>
<h2 id="WUSTCTF2020-level1"><a href="#WUSTCTF2020-level1" class="headerlink" title="[WUSTCTF2020]level1"></a>[WUSTCTF2020]level1</h2><p>很简单的逻辑 简单记录</p>
<h3 id="主逻辑-1"><a href="#主逻辑-1" class="headerlink" title="主逻辑"></a>主逻辑</h3><pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl main(int argc, const char **argv, const char **envp)
{
  int i; // [rsp+4h] [rbp-2Ch]
  FILE *stream; // [rsp+8h] [rbp-28h]
  char ptr[24]; // [rsp+10h] [rbp-20h] BYREF
  unsigned __int64 v7; // [rsp+28h] [rbp-8h]

  v7 = __readfsqword(0x28u);
  stream = fopen("flag", "r");
  fread(ptr, 1uLL, 20uLL, stream);
  fclose(stream);
  for ( i = 1; i &lt;= 19; ++i )
  {
    if ( (i &amp; 1) != 0 )
      printf("%ld\n", (unsigned int)(ptr[i] &lt;&lt; i));
    else
      printf("%ld\n", (unsigned int)(i * ptr[i]));
  }
  return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="解密脚本-7"><a href="#解密脚本-7" class="headerlink" title="解密脚本"></a>解密脚本</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'[WUSTCTF2020]level1\output.txt'</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    flag <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> i <span class="token operator">&amp;</span> <span class="token number">1</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            tem <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> i<span class="token punctuation">)</span>
            flag <span class="token operator">+=</span> tem
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tem <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span> <span class="token operator">//</span> i<span class="token punctuation">)</span>
            flag <span class="token operator">+=</span> tem
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="MRCTF2020-Transform"><a href="#MRCTF2020-Transform" class="headerlink" title="[MRCTF2020]Transform"></a>[MRCTF2020]Transform</h2><h3 id="关键逻辑-1"><a href="#关键逻辑-1" class="headerlink" title="关键逻辑"></a>关键逻辑</h3><pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl main(int argc, const char **argv, const char **envp)
{
  char Str[104]; // [rsp+20h] [rbp-70h] BYREF
  int j; // [rsp+88h] [rbp-8h]
  int i; // [rsp+8Ch] [rbp-4h]

  sub_402230(argc, argv, envp);
  printf("Give me your code:\n");
  scanf("%s", Str);
  if ( strlen(Str) != 33 )                      // 长度33
  {
    printf("Wrong!\n");
    system("pause");
    exit(0);
  }
  for ( i = 0; i &lt;= 32; ++i )                   // 按位处理
  {
    byte_414040[i] = Str[dword_40F040[i]];
    byte_414040[i] ^= LOBYTE(dword_40F040[i]);
  }
  for ( j = 0; j &lt;= 32; ++j )                   // 按位比较
  {
    if ( byte_40F0E0[j] != byte_414040[j] )
    {
      printf("Wrong!\n");
      system("pause");
      exit(0);
    }
  }
  printf("Right!Good Job!\n");
  printf("Here is your flag: %s\n", Str);
  system("pause");
  return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>长度为33</p>
<h3 id="解密脚本-8"><a href="#解密脚本-8" class="headerlink" title="解密脚本"></a>解密脚本</h3><p>每四个字节取单字节整数 有练习到切片</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">dword_40F040 <span class="token operator">=</span> <span class="token string">b'\t\x00\x00\x00\n\x00\x00\x00\x0f\x00\x00\x00\x17\x00\x00\x00\x07\x00\x00\x00\x18\x00\x00\x00\x0c\x00\x00\x00\x06\x00\x00\x00\x01\x00\x00\x00\x10\x00\x00\x00\x03\x00\x00\x00\x11\x00\x00\x00 \x00\x00\x00\x1d\x00\x00\x00\x0b\x00\x00\x00\x1e\x00\x00\x00\x1b\x00\x00\x00\x16\x00\x00\x00\x04\x00\x00\x00\r\x00\x00\x00\x13\x00\x00\x00\x14\x00\x00\x00\x15\x00\x00\x00\x02\x00\x00\x00\x19\x00\x00\x00\x05\x00\x00\x00\x1f\x00\x00\x00\x08\x00\x00\x00\x12\x00\x00\x00\x1a\x00\x00\x00\x1c\x00\x00\x00\x0e\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'</span>
byte_40F0E0 <span class="token operator">=</span> <span class="token string">b'gy{\x7fu+&lt;RSyW^]B{-*fB~LWyAk~e&lt;\\EobM'</span>
byte_414040 <span class="token operator">=</span> <span class="token string">''</span>
index <span class="token operator">=</span> dword_40F040<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    byte_414040 <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>index<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> byte_40F0E0<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>byte_414040<span class="token punctuation">)</span>
a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">33</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    a<span class="token punctuation">[</span>index<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> byte_414040<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h2 id="Youngter-drive（好评）"><a href="#Youngter-drive（好评）" class="headerlink" title="Youngter-drive（好评）"></a>Youngter-drive（好评）</h2><h3 id="关键函数"><a href="#关键函数" class="headerlink" title="关键函数"></a>关键函数</h3><pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl main_0(int argc, const char **argv, const char **envp)
{
  HANDLE v4; // [esp+D0h] [ebp-14h]
  HANDLE hObject; // [esp+DCh] [ebp-8h]

  ((void (*)(void))sub_4110FF)();               // 录入%36s的字符
  ::hObject = CreateMutexW(0, 0, 0);
  j_strcpy(Destination, &amp;Source);
  hObject = CreateThread(0, 0, StartAddress, 0, 0, 0);// 线程1
  v4 = CreateThread(0, 0, sub_41119F, 0, 0, 0); // 线程2
  CloseHandle(hObject);
  CloseHandle(v4);
  while ( dword_418008 != -1 )                  // 执行完毕
    ;
  sub_411190();                                 // 比对结果
  CloseHandle(::hObject);
  return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>sub_4110FF</code>录入输入</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">// attributes: thunk
int sub_4110FF(void)
{
  return sub_411BD0();
}

int sub_411BD0()
{
  printf(
    "1111111111111111111111111111111111111111111111111111111111111111111111111111111\n"
    "*******************************************************************************\n"
    "**************             ****************************************************\n"
    "**************   ********   *********************                 *************\n"
    "**************   *********  *********************   ***************************\n"
    "**************   *********  *********************   ***************************\n"
    "**************   *********  *********************   ***************************\n"
    "**************   *******   **********************   ***************************\n"
    "**************   ****   *************************   ***************************\n"
    "**************   *    ***************************                **************\n"
    "**************   ***    *************************   ***************************\n"
    "**************   ******   ***********************   ***************************\n"
    "**************   ********   *********************   ***************************\n"
    "**************   **********   *******************   ***************************\n"
    "**************   ***********    *****************                 *************\n"
    "*******************************************************************************\n"
    "1111111111111111111111111111111111111111111111111111111111111111111111111111111\n");
  printf("input flag:\n");
  return scanf("%36s", Source);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><code>StartAddress</code></p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">void __stdcall StartAddress_0(int a1)
{
  while ( 1 )
  {
    WaitForSingleObject(hObject, 0xFFFFFFFF);
    if ( dword_418008 &gt; -1 )
    {
      sub_41112C(&amp;Source, dword_418008);        // 处理对应字符
      --dword_418008;
      Sleep(0x64u);
    }
    ReleaseMutex(hObject);
  }
}

// attributes: thunk
char *__cdecl sub_41112C(int a1, int a2)
{
  return sub_411940(a1, a2);
}

// positive sp value has been detected, the output may be wrong!
char *__cdecl sub_411940(int a1, int a2)
{
  char *result; // eax
  char v3; // [esp+D3h] [ebp-5h]

  v3 = *(_BYTE *)(a2 + a1);
  if ( (v3 &lt; 97 || v3 &gt; 122) &amp;&amp; (v3 &lt; 65 || v3 &gt; 90) )// 要求为字母
    exit(0);
  if ( v3 &lt; 97 || v3 &gt; 122 )                    // 大写字母对应表后26位
  {
    result = off_418000[0];
    *(_BYTE *)(a2 + a1) = off_418000[0][*(char *)(a2 + a1) - 38];
  }
  else                                          // 小写字母对应表前26位
  {
    result = off_418000[0];
    *(_BYTE *)(a2 + a1) = off_418000[0][*(char *)(a2 + a1) - 96];
  }
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><code>sub_41119F</code></p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">// attributes: thunk
DWORD __stdcall sub_41119F(LPVOID lpThreadParameter)
{
  return sub_411B10(lpThreadParameter);
}

void __stdcall sub_411B10(int a1)
{
  while ( 1 )
  {
    WaitForSingleObject(hObject, 0xFFFFFFFF);
    if ( dword_418008 &gt; -1 )
    {
      Sleep(0x64u);
      --dword_418008;
    }
    ReleaseMutex(hObject);
  }
}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
<li><p><code>sub_411190</code></p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">// attributes: thunk
int sub_411190(void)
{
  return sub_411880();
}

int sub_411880()
{
  int i; // [esp+D0h] [ebp-8h]

  for ( i = 0; i &lt; 29; ++i )
  {
    if ( Source[i] != off_418004[i] )
      exit(0);
  }
  return printf("\nflag{%s}\n\n", Destination);
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<h3 id="流程分析"><a href="#流程分析" class="headerlink" title="流程分析"></a>流程分析</h3><p>主函数通过打开了两个线程来处理输入</p>
<p>线程1和线程2通过Sleep交替执行</p>
<p>每执行一次将<code>dword_418008</code>减一 其初始值为29</p>
<ul>
<li>线程1处理<code>input[dword_418008]</code>的输入</li>
</ul>
<p>​    <code>input</code>长度为29 所以第一次不会处理</p>
<ul>
<li>线程2不处理输入 单纯将<code>dword_418008</code>减1</li>
</ul>
<p>也就是隔一位处理一位 处理的起始点为字符串倒数第二个字符 方向向前</p>
<h3 id="解密脚本-9"><a href="#解密脚本-9" class="headerlink" title="解密脚本"></a>解密脚本</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#最终比对</span>
off_418004 <span class="token operator">=</span> <span class="token string">'TOiZiZtOrYaToUwPnToBsOaOapsyS\x00'</span> 
<span class="token comment">#线程处理表</span>
off_418000 <span class="token operator">=</span> <span class="token string">'QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm'</span> 

<span class="token keyword">def</span> <span class="token function">look_v</span><span class="token punctuation">(</span>a1<span class="token punctuation">)</span><span class="token punctuation">:</span>
    index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>off_418000<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> a1 <span class="token operator">==</span> off_418000<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
            index <span class="token operator">=</span> i
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> index <span class="token operator">&lt;=</span> <span class="token number">25</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">96</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        res <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">38</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res

flag <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>off_418004<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>off_418004<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        flag<span class="token punctuation">[</span><span class="token number">29</span><span class="token operator">-</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> look_v<span class="token punctuation">(</span>off_418004<span class="token punctuation">[</span><span class="token number">29</span><span class="token operator">-</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> flag<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>PS： 为了正常执行程序 在输入最后要随便加一位 按理说是 buuoj上只能提交E</p>
<h2 id="Maze"><a href="#Maze" class="headerlink" title="Maze"></a>Maze</h2><h3 id="分析过程-1"><a href="#分析过程-1" class="headerlink" title="分析过程"></a>分析过程</h3><p>先处理一下花指令</p>
<p><img src="%E9%80%86%E5%90%91%E7%BB%83%E4%B9%A0%E8%AE%B0%E5%BD%95.assets/image-20220510132533059.png" alt="image-20220510132533059"></p>
<p>在函数开头重新生成函数</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl main(int argc, const char **argv, const char **envp)
{
  int i; // [esp+10h] [ebp-14h]
  char input[16]; // [esp+14h] [ebp-10h] BYREF

  printf(aGoThroughTheMa);
  scanf("%14s", input);
  for ( i = 0; i &lt;= 13; ++i )
  {
    switch ( input[i] )
    {
      case 'a':
        --*(_DWORD *)asc_408078;                // left
        break;
      case 'd':
        ++*(_DWORD *)asc_408078;                // right
        break;
      case 's':
        --dword_40807C;                         // down
        break;
      case 'w':
        ++dword_40807C;                         // up
        break;
      default:
        continue;
    }
  }
  if ( *(_DWORD *)asc_408078 == 5 &amp;&amp; dword_40807C == -4 )
  {
    printf(aCongratulation);
    printf(aHereIsTheFlagF);
  }
  else
  {
    printf(aTryAgain);
  }
  return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现关键变量</p>
<pre class="line-numbers language-none"><code class="language-none">asc_408078      db 7
dword_40807C    dd 0
maze = '*******+********* ******    ****   ******* **F******    **************'<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>最终需要<code>*(_DWORD *)asc_408078 == 5 &amp;&amp; dword_40807C == -4</code></p>
<h3 id="画迷宫"><a href="#画迷宫" class="headerlink" title="画迷宫"></a>画迷宫</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">maze <span class="token operator">=</span> <span class="token string">'*******+********* ******    ****   ******* **F******    **************'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>maze<span class="token punctuation">)</span><span class="token punctuation">)</span>
temp <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">70</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>maze<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
    temp <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> temp <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
        temp <span class="token operator">=</span> <span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>得到迷宫如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span><span class="token operator">+</span><span class="token operator">**</span>
<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span> <span class="token operator">**</span>
<span class="token operator">**</span><span class="token operator">**</span>    <span class="token operator">**</span>
<span class="token operator">**</span>   <span class="token operator">**</span><span class="token operator">**</span><span class="token operator">*</span>
<span class="token operator">**</span> <span class="token operator">**</span>F<span class="token operator">**</span><span class="token operator">**</span>
<span class="token operator">**</span>    <span class="token operator">**</span><span class="token operator">**</span>
<span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span class="token operator">**</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>于是得flag{ssaaasaassdddw}</p>
<h2 id="FlareOn6-Overlong"><a href="#FlareOn6-Overlong" class="headerlink" title="[FlareOn6]Overlong"></a>[FlareOn6]Overlong</h2><p>对数据段进行解码</p>
<h3 id="题目信息"><a href="#题目信息" class="headerlink" title="题目信息"></a>题目信息</h3><pre class="line-numbers language-C" data-language="C"><code class="language-C">int __stdcall start(int a1, int a2, int a3, int a4)
{
  CHAR Text[128]; // [esp+0h] [ebp-84h] BYREF
  unsigned int v6; // [esp+80h] [ebp-4h]

  v6 = sub_401160(Text, (int)&amp;unk_402008, 0x1Cu); //长度28
  Text[v6] = 0;
  MessageBoxA(0, Text, Caption, 0);
  return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p><code>sub_401160</code>对<code>unk_402008</code>进行解密，赋值到text中。</p>
<p>最后直接弹出消息，直接打开程序效果如下</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220515130527614.png" alt="image-20220515130527614"></p>
<p>发现没给出关键信息，而去看数据段其实长度有175，而函数中只用到了28的长度</p>
<p>所以这里可以猜到如果将完整的数据段解密即可拿到flag</p>
<h3 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h3><p>思路就是通过模仿正向算法将完整的数据段进行解码</p>
<p>具体函数</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">unsigned int __cdecl sub_401160(char *a1, int rdata, unsigned int a3)
{
  unsigned int i; // [esp+4h] [ebp-4h]

  for ( i = 0; i &lt; a3; ++i )                    // 长度28
  {
    rdata += sub_401000(a1, (char *)rdata);
    if ( !*a1++ )
      break;
  }
  return i;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里每产生一个字符后就将rdata向前推进</p>
<p>生成字符的函数<code>sub_401000</code>如下</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl sub_401000(_BYTE *flag, char *rdata)
{
  int v3; // [esp+0h] [ebp-8h]
  char v4; // [esp+4h] [ebp-4h]

  if ( (int)(unsigned __int8)*rdata &gt;&gt; 3 == 30 )
  {
    v4 = rdata[3] &amp; 0x3F | ((rdata[2] &amp; 0x3F) &lt;&lt; 6);
    v3 = 4;
  }
  else if ( (int)(unsigned __int8)*rdata &gt;&gt; 4 == 14 )
  {
    v4 = rdata[2] &amp; 0x3F | ((rdata[1] &amp; 0x3F) &lt;&lt; 6);
    v3 = 3;
  }
  else if ( (int)(unsigned __int8)*rdata &gt;&gt; 5 == 6 )
  {
    v4 = rdata[1] &amp; 0x3F | ((*rdata &amp; 0x1F) &lt;&lt; 6);
    v3 = 2;
  }
  else
  {
    v4 = *rdata;
    v3 = 1;
  }
  *flag = v4;
  return v3;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里是根据rdata当前位的值来决定 每1/2/3/4位生成一个字符</p>
<p>我们要将完整的数据段解码就一直循环这个函数到数据段数据结束为止</p>
<p>解密脚本如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">rdata <span class="token operator">=</span> <span class="token string">'\xe0\x81\x89\xc0\xa0\xc1\xae\xe0\x81\xa5\xc1\xb6\xf0\x80\x81\xa5\xe0\x81\xb2\xf0\x80\x80\xa0\xe0\x81\xa2ro\xc1\xabe\xe0\x80\xa0\xe0\x81\xb4\xe0\x81\xa8\xc1\xa5 \xc1\xa5\xe0\x81\xaec\xc1\xaf\xe0\x81\xa4\xf0\x80\x81\xa9n\xc1\xa7\xc0\xba I\xf0\x80\x81\x9f\xc1\xa1\xc1\x9f\xc1\x8d\xe0\x81\x9f\xc1\xb4\xf0\x80\x81\x9f\xf0\x80\x81\xa8\xc1\x9f\xf0\x80\x81\xa5\xe0\x81\x9f\xc1\xa5\xe0\x81\x9f\xf0\x80\x81\xae\xc1\x9f\xf0\x80\x81\x83\xc1\x9f\xe0\x81\xaf\xe0\x81\x9f\xc1\x84_\xe0\x81\xa9\xf0\x80\x81\x9fn\xe0\x81\x9f\xe0\x81\xa7\xe0\x81\x80\xf0\x80\x81\xa6\xf0\x80\x81\xac\xe0\x81\xa1\xc1\xb2\xc1\xa5\xf0\x80\x80\xad\xf0\x80\x81\xafn\xc0\xae\xf0\x80\x81\xa3o\xf0\x80\x81\xad'</span>
data <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>rdata<span class="token punctuation">)</span>
flag <span class="token operator">=</span> <span class="token string">''</span>
j <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>j <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rdata<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>rdata<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">30</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>rdata<span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>rdata<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        j <span class="token operator">+=</span> <span class="token number">4</span>
    <span class="token keyword">elif</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>rdata<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">4</span> <span class="token operator">==</span> <span class="token number">14</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>rdata<span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>rdata<span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        j <span class="token operator">+=</span> <span class="token number">3</span>
    <span class="token keyword">elif</span> <span class="token builtin">ord</span><span class="token punctuation">(</span>rdata<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">5</span> <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>rdata<span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x3f</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>rdata<span class="token punctuation">[</span><span class="token number">0</span> <span class="token operator">+</span> j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0x1f</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        j <span class="token operator">+=</span> <span class="token number">2</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> rdata<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
        j <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="动态方法"><a href="#动态方法" class="headerlink" title="动态方法"></a>动态方法</h3><p>这道题前面没动脑子 静态做完了之后才发现动态其实最快</p>
<p>因为题目自己会运行解密函数，只是因为长度没给够所以不会打印出flag。</p>
<p>那么我们只需要把<code>sub_401160</code>函数的长度参数给扩大到175（完整数据段的长度）就能看到flag了</p>
<p>那么就开始调试程序</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220515131513546.png" alt="image-20220515131513546"></p>
<p>在<code>push 1C</code>执行之后将栈顶从<code>0x1C</code>修改为<code>0XAF</code></p>
<p>接着关注text地址空间，在执行完<code>4c1160</code>函数后查看text地址空间。</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220515131838518.png" alt="image-20220515131838518"></p>
<p>直接能看到flag内容</p>
<p>顺便练习下导出的脚本</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> binascii
flag <span class="token operator">=</span> <span class="token string">'49 20 6E 65 76 65 72 20 62 72 6F 6B 65 20 74 68 65 20 65 6E 63 6F 64 69 6E 67 3A 20 49 5F 61 5F 4D 5F 74 5F 68 5F 65 5F 65 5F 6E 5F 43 5F 6F 5F 44 5F 69 5F 6E 5F 67 40 66 6C 61 72 65 2D 6F 6E 2E 63 6F 6D'</span>
new <span class="token operator">=</span> <span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">' '</span><span class="token punctuation">:</span>
        new <span class="token operator">+=</span> flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>new<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>







<h1 id="Java-Android"><a href="#Java-Android" class="headerlink" title="Java/Android"></a>Java/Android</h1><h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><p>题目就是一个<code>Reverse.class</code>文件</p>
<p>将class文件拖入JD-GUI分析</p>
<p>看到内容如下</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Scanner</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Reverse</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">Scanner</span> s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>"<span class="token class-name">Please</span> input the flag <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>"<span class="token class-name">Your</span> input is <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> stringArr <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Encrypt</span><span class="token punctuation">(</span>stringArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Encrypt</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Resultlist</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">int</span> result <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">64</span> <span class="token operator">^</span> <span class="token number">0x20</span><span class="token punctuation">;</span>
      <span class="token class-name">Resultlist</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> KEY <span class="token operator">=</span> <span class="token punctuation">{</span> 
        <span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">148</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> 
        <span class="token number">133</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">65</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">KEYList</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> KEY<span class="token punctuation">.</span>length<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
      <span class="token class-name">KEYList</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>KEY<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Result:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Resultlist</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">KEYList</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>"<span class="token class-name">Congratulations</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>err<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>"<span class="token class-name">Error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>直接逆向解密一下就可以</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
	flag <span class="token operator">=</span> <span class="token string">''</span>
	Key <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">137</span><span class="token punctuation">,</span> <span class="token number">147</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">148</span><span class="token punctuation">,</span> <span class="token number">136</span><span class="token punctuation">,</span> 
        <span class="token number">133</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">134</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">135</span><span class="token punctuation">,</span> <span class="token number">191</span><span class="token punctuation">,</span> <span class="token number">65</span><span class="token punctuation">]</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		temp <span class="token operator">=</span> Key<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">^</span> <span class="token number">0x20</span>
		temp <span class="token operator">-=</span> <span class="token number">64</span>
		flag <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="简单注册器"><a href="#简单注册器" class="headerlink" title="简单注册器"></a>简单注册器</h2><p><del>使用Smali2Java将APK反编译并将smali转换成java代码</del></p>
<p>Smali2Java翻译的代码有错 shit 换成JEB之后就好了</p>
<p>使用JEB将APK反编译并将smali转换成java代码</p>
<p>找到关键逻辑如下</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>flag</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>v4<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">Fragment</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>support<span class="token punctuation">.</span>v7<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">ActionBarActivity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">LayoutInflater</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">Menu</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">MenuItem</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">ViewGroup</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">Button</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">EditText</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">TextView</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">ActionBarActivity</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">PlaceholderFragment</span> <span class="token keyword">extends</span> <span class="token class-name">Fragment</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>  <span class="token comment">// android.support.v4.app.Fragment</span>
        <span class="token keyword">public</span> <span class="token class-name">View</span> <span class="token function">onCreateView</span><span class="token punctuation">(</span><span class="token class-name">LayoutInflater</span> arg4<span class="token punctuation">,</span> <span class="token class-name">ViewGroup</span> arg5<span class="token punctuation">,</span> <span class="token class-name">Bundle</span> arg6<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> arg4<span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token number">0x7F030018</span><span class="token punctuation">,</span> arg5<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// layout:fragment_main</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>  <span class="token comment">// android.support.v7.app.ActionBarActivity</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> arg7<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>arg7<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token number">0x7F030017</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// layout:activity_main</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>arg7 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSupportFragmentManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">beginTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">0x7F05003C</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PlaceholderFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// id:container</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Button</span> button <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token number">0x7F05003F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// id:button1</span>
        <span class="token class-name">TextView</span> textview <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TextView</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token number">0x7F05003E</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// id:textView1</span>
        button<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>  <span class="token comment">// android.view.View$OnClickListener</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> arg13<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                <span class="token class-name">String</span> xx <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">EditText</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token number">0x7F05003D</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// id:editText1</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>xx<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0x20</span> <span class="token operator">||</span> xx<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0x1F</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">97</span> <span class="token operator">||</span> xx<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">98</span> <span class="token operator">||</span> xx<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> xx<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x30</span> <span class="token operator">!=</span> <span class="token number">56</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">char</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x <span class="token operator">=</span> <span class="token string">"dd2940c04462b4dd7c450528835cca15"</span><span class="token punctuation">.</span><span class="token function">toCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    x<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    x<span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0x1F</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    x<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">27</span><span class="token punctuation">]</span> <span class="token operator">+</span> x<span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">97</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">char</span> a <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">0x1F</span> <span class="token operator">-</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        x<span class="token punctuation">[</span><span class="token number">0x1F</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> x<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
                        x<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>

                    textview<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"flag{"</span> <span class="token operator">+</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                textview<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">"输入注册码错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>  <span class="token comment">// android.app.Activity</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onCreateOptionsMenu</span><span class="token punctuation">(</span><span class="token class-name">Menu</span> arg3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getMenuInflater</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inflate</span><span class="token punctuation">(</span><span class="token number">0x7F0C0000</span><span class="token punctuation">,</span> arg3<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// menu:main</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>  <span class="token comment">// android.app.Activity</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onOptionsItemSelected</span><span class="token punctuation">(</span><span class="token class-name">MenuItem</span> arg3<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> arg3<span class="token punctuation">.</span><span class="token function">getItemId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x7F050040</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onOptionsItemSelected</span><span class="token punctuation">(</span>arg3<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// id:action_settings</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="直接正向输入"><a href="#直接正向输入" class="headerlink" title="直接正向输入"></a>直接正向输入</h3><p>发现判断逻辑很短</p>
<ul>
<li>长度为32</li>
<li>(xx.charAt(0x1f) != 0x61) || 最后一位a</li>
<li>(xx.charAt(0x1) != 0x62) || 第二位b</li>
<li>(((xx.charAt(0x0) + xx.charAt(0x2)) - 0x30) != 0x38) || xx[0] + xx[3] = 0x68</li>
</ul>
<p>直接构造满足条件的字符串</p>
<p><code>0b8xxxxxxxxxxxxxxxxxxxxxxxxxxxxa</code></p>
<p>flag{59acc538825054c7de4b26440c0999dd}</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220424130420197.png" alt="image-20220424130420197"></p>
<h3 id="算法计算"><a href="#算法计算" class="headerlink" title="算法计算"></a>算法计算</h3><p>抄一个正向的代码</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
	flagtrue <span class="token operator">=</span> <span class="token string">'dd2940c04462b4dd7c450528835cca15'</span>
	a <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>flagtrue<span class="token punctuation">)</span>
	a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x32</span><span class="token punctuation">)</span>
	a<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x30</span><span class="token punctuation">)</span>
	a<span class="token punctuation">[</span><span class="token number">0x1e</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0x1f</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0x9</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x30</span><span class="token punctuation">)</span>
	a<span class="token punctuation">[</span><span class="token number">0xe</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0x1b</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token builtin">ord</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0x1c</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x61</span><span class="token punctuation">)</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		ch <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token number">0x1f</span> <span class="token operator">-</span> i<span class="token punctuation">]</span>
		a<span class="token punctuation">[</span><span class="token number">0x1f</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> a<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
		a<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> ch
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>计算得Flag = ‘59acc538825054c7de4b26440c0999dd’</p>
<h2 id="相册"><a href="#相册" class="headerlink" title="相册"></a>相册</h2><p>题目介绍:</p>
<blockquote>
<p>你好，这是上次聚会相片，你看看（病毒，不建议安装到手机，提取完整邮箱即为flag） 注意：得到的 flag 请包上 flag{} 提交</p>
</blockquote>
<h3 id="APK分析"><a href="#APK分析" class="headerlink" title="APK分析"></a>APK分析</h3><p>APK拖入<code>jadx-gui</code></p>
<p>从题目描述可以搜索一下mail相关的代码</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220510131124383.png" alt="image-20220510131124383"></p>
<p>定位到<code>sendMailByJavaMail</code>函数</p>
<pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">sendMailByJavaMail</span><span class="token punctuation">(</span><span class="token class-name">String</span> mailto<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> mailmsg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>debug<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Mail</span> m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Mail</span><span class="token punctuation">(</span>C2<span class="token punctuation">.</span>MAILUSER<span class="token punctuation">,</span> C2<span class="token punctuation">.</span>MAILPASS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m<span class="token punctuation">.</span><span class="token function">set_host</span><span class="token punctuation">(</span>C2<span class="token punctuation">.</span>MAILHOST<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m<span class="token punctuation">.</span><span class="token function">set_port</span><span class="token punctuation">(</span>C2<span class="token punctuation">.</span>PORT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m<span class="token punctuation">.</span><span class="token function">set_debuggable</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> toArr <span class="token operator">=</span> <span class="token punctuation">{</span>mailto<span class="token punctuation">}</span><span class="token punctuation">;</span>
        m<span class="token punctuation">.</span><span class="token function">set_to</span><span class="token punctuation">(</span>toArr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m<span class="token punctuation">.</span><span class="token function">set_from</span><span class="token punctuation">(</span>C2<span class="token punctuation">.</span>MAILFROME<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m<span class="token punctuation">.</span><span class="token function">set_subject</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
        m<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span>mailmsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">"IcetestActivity"</span><span class="token punctuation">,</span> <span class="token string">"Email was sent successfully."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">"IcetestActivity"</span><span class="token punctuation">,</span> <span class="token string">"Email was sent failed."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span><span class="token string">"MailApp"</span><span class="token punctuation">,</span> <span class="token string">"Could not send email"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>定位到C2类</p>
<pre class="line-numbers language-JAVA" data-language="JAVA"><code class="language-JAVA">public class C2 {
    public static final String CANCELNUMBER = "%23%2321%23";
    public static final String MAILHOST = "smtp.163.com";
    public static final String MOVENUMBER = "**21*121%23";
    public static final String PORT = "25";
    public static final String date = "2115-11-1";
    public static final String MAILSERVER = Base64.decode(NativeMethod.m());
    public static final String MAILUSER = Base64.decode(NativeMethod.m());
    public static final String MAILPASS = Base64.decode(NativeMethod.pwd());
    public static final String MAILFROME = Base64.decode(NativeMethod.m());
    public static final String phoneNumber = Base64.decode(NativeMethod.p());

    static {
        System.loadLibrary("core");
    }

    public static Date strToDateLong(String strDate) {
        SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd");
        ParsePosition pos = new ParsePosition(0);
        Date strtodate = formatter.parse(strDate, pos);
        return strtodate;
    }

    public static boolean isFilter(Context context) {
        Date lastN = strToDateLong(date);
        Date currentTime = new Date();
        return lastN.getTime() - currentTime.getTime() &lt; 0;
    }

    public static boolean isServerFilter(Context context) {
        SharedPreferences mSharedPreferences = context.getSharedPreferences("X", 0);
        String m = mSharedPreferences.getString("m", A2.FILTERSETUPTAG);
        if (m.equals(A2.FILTERSETUPTAG)) {
            return true;
        }
        return false;
    }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现<code>MAILSERVER = Base64.decode(NativeMethod.m());</code></p>
<p>于是需要定位到Native代码的m方法</p>
<p>将其中的返回的字符串进行Base64解码即可获得邮箱地址</p>
<h3 id="Native分析"><a href="#Native分析" class="headerlink" title="Native分析"></a>Native分析</h3><p>定位到方法m</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int __fastcall Java_com_net_cn_NativeMethod_m(int a1)
{
  return (*(int (__fastcall **)(int, const char *))(*(_DWORD *)a1 + 668))(a1, "MTgyMTg0NjUxMjVAMTYzLmNvbQ==");
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>看到base64编码直接给了，完成！</p>
<h3 id="解密脚本-10"><a href="#解密脚本-10" class="headerlink" title="解密脚本"></a>解密脚本</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64
<span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span><span class="token string">'MTgyMTg0NjUxMjVAMTYzLmNvbQ=='</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>





<h1 id="密码学"><a href="#密码学" class="headerlink" title="密码学"></a>密码学</h1><h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><p>题目给了两个文件</p>
<ul>
<li><p>flag.enc</p>
<p>文件内容如图</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220425123427649.png" alt="image-20220425123427649"></p>
</li>
<li><p>pub.key</p>
<p>文件内容如下</p>
<pre class="line-numbers language-none"><code class="language-none">-----BEGIN PUBLIC KEY-----
MDwwDQYJKoZIhvcNAQEBBQADKwAwKAIhAMAzLFxkrkcYL2wch21CM2kQVFpY9+7+
/AvKr1rzQczdAgMBAAE=
-----END PUBLIC KEY-----<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>对这个方向了解不够 直接搜罗一波攻略</p>
<p><a target="_blank" rel="noopener" href="http://www.flydean.com/rsa">RSA算法详解 | 程序那些事 (flydean.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Mayfly-nymph/p/11576913.html">BUUCTF–rsa - Hk_Mayfly - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://err0rzz.github.io/2017/11/14/CTF%E4%B8%ADRSA%E5%A5%97%E8%B7%AF/">CTF中RSA套路 | Err0r (err0rzz.github.io)</a></p>
<h3 id="解体思路"><a href="#解体思路" class="headerlink" title="解体思路"></a>解体思路</h3><p>题目给我们提供了</p>
<ul>
<li><p>加密的公钥</p>
<p>通过加密的公钥可以得知</p>
<ul>
<li>大素数乘积N: $N = p * q$</li>
<li>加密用的素数E: $密文 = 明文^D mod N$</li>
</ul>
</li>
<li><p>加密后的密文</p>
<p>想要得到明文需要求E</p>
<p>$明文 = 密文^E mod N$</p>
</li>
</ul>
<p>想要求解密的d </p>
<p>需要拆解两个素数p,q 即找到p,q使得 $n = p * q$</p>
<p>利用p和q计算phi(n)</p>
<p>再利用$E*D = 1\  mod\ phi(n)$</p>
<p>计算出D</p>
<p>即可利用私钥进行解密了</p>
<p>该题的n长度不大，可以直接利用yahu爆破出pq。</p>
<h3 id="通过公钥解析得到n和e"><a href="#通过公钥解析得到n和e" class="headerlink" title="通过公钥解析得到n和e"></a>通过公钥解析得到n和e</h3><p>利用线上工具完成<a target="_blank" rel="noopener" href="http://tool.chacuo.net/cryptrsakeyparse">RSA公私钥分解 Exponent、Modulus，Rsa公私钥指数、系数(模数)分解–查错网 (chacuo.net)</a></p>
<p>公钥指数及模数信息:</p>
<table>
<thead>
<tr>
<th>key长度：</th>
<th>256</th>
</tr>
</thead>
<tbody><tr>
<td>模数：</td>
<td>C0332C5C64AE47182F6C1C876D42336910545A58F7EEFEFC0BCAAF5AF341CCDD</td>
</tr>
<tr>
<td>指数：</td>
<td>65537 (0x10001)</td>
</tr>
</tbody></table>
<h3 id="利用yafu分解n获取p，q"><a href="#利用yafu分解n获取p，q" class="headerlink" title="利用yafu分解n获取p，q"></a>利用yafu分解n获取p，q</h3><p>将指数作为输入</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220425185317822.png" alt="image-20220425185317822"></p>
<p>得到</p>
<pre class="line-numbers language-none"><code class="language-none">p = 304008741604601924494328155975272418463
q = 285960468890451637935629440372639283459<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h3 id="解密脚本-11"><a href="#解密脚本-11" class="headerlink" title="解密脚本"></a>解密脚本</h3><p>安装gmpy2库</p>
<p>已知e,p,q可以求d</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>安装rsa库</p>
<p>已知n,e,d,p,q可以求skey</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">skey <span class="token operator">=</span> rsa<span class="token punctuation">.</span>PrivateKey<span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>所以完全脚本如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> rsa

n <span class="token operator">=</span> <span class="token number">0xC0332C5C64AE47182F6C1C876D42336910545A58F7EEFEFC0BCAAF5AF341CCDD</span>
e <span class="token operator">=</span> <span class="token number">65537</span>
p <span class="token operator">=</span> <span class="token number">304008741604601924494328155975272418463</span>
q <span class="token operator">=</span> <span class="token number">2859604688904516379356294403726392834</span>
phi <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span> phi<span class="token punctuation">)</span>
skey <span class="token operator">=</span> rsa<span class="token punctuation">.</span>PrivateKey<span class="token punctuation">(</span>n<span class="token punctuation">,</span> e<span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">,</span> q<span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'.\\RSA\\flag.enc'</span><span class="token punctuation">,</span><span class="token string">'rb+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    text <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>rsa<span class="token punctuation">.</span>decrypt<span class="token punctuation">(</span>text<span class="token punctuation">,</span> skey<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="SUCTF2019-SignIn"><a href="#SUCTF2019-SignIn" class="headerlink" title="[SUCTF2019]SignIn"></a>[SUCTF2019]SignIn</h2><h3 id="主要逻辑-1"><a href="#主要逻辑-1" class="headerlink" title="主要逻辑"></a>主要逻辑</h3><pre class="line-numbers language-C" data-language="C"><code class="language-C">__int64 __fastcall main(int a1, char **a2, char **a3)
{
  char v4[16]; // [rsp+0h] [rbp-4A0h] BYREF
  char v5[16]; // [rsp+10h] [rbp-490h] BYREF
  char v6[16]; // [rsp+20h] [rbp-480h] BYREF
  char v7[16]; // [rsp+30h] [rbp-470h] BYREF
  char v8[112]; // [rsp+40h] [rbp-460h] BYREF
  char v9[1000]; // [rsp+B0h] [rbp-3F0h] BYREF
  unsigned __int64 v10; // [rsp+498h] [rbp-8h]

  v10 = __readfsqword(0x28u);
  puts("[sign in]");
  printf("[input your flag]: ");
  __isoc99_scanf("%99s", v8);
  sub_96A(v8, v9);
  __gmpz_init_set_str(v7, "ad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35", 16LL);
  __gmpz_init_set_str(v6, v9, 16LL);
  __gmpz_init_set_str(v4, "103461035900816914121390101299049044413950405173712170434161686539878160984549", 10LL);
  __gmpz_init_set_str(v5, "65537", 10LL);
  __gmpz_powm(v6, v6, v5, v4);
  if ( (unsigned int)__gmpz_cmp(v6, v7) )
    puts("GG!");
  else
    puts("TTTTTTTTTTql!");
  return 0LL;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>一开始看<code>sub_96A</code>有点卡壳 </p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">size_t __fastcall sub_96A(const char *a1, __int64 a2)
{
  size_t result; // rax
  int v3; // [rsp+18h] [rbp-18h]
  int i; // [rsp+1Ch] [rbp-14h]

  v3 = 0;
  for ( i = 0; ; i += 2 )
  {
    result = strlen(a1);
    if ( v3 &gt;= result )
      break;
    *(_BYTE *)(a2 + i) = byte_202010[a1[v3] &gt;&gt; 4];
    *(_BYTE *)(a2 + i + 1LL) = byte_202010[a1[v3++] &amp; 0xF];
  }
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>看着就感觉这个函数是不可逆的，这真的能做嘛？</p>
<p>这里<code>&gt;&gt;4</code> 和 <code>&amp;0xF</code>操作</p>
<p>前面是取高4位 后面是取低4位</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">1001.1111.1101.1001 &gt;&gt; 4 = 0000.1001.1111.1101

0000.1001.1111.1101 &amp; 0x0F = 1101 (or 0000.0000.0000.1101 to be more explicit)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<p>然后是下面用了<code>gmpz</code>前缀的一系列API也没整明白</p>
<p>搜了一下是高精度数学计算库</p>
<p>趁着周五组会看了半天也没看出个所以然</p>
<p>于是看了一下攻略，才意识到是RSA。</p>
<p>瞬间这几个长字符串和数字都意识到是啥了 焯！</p>
<h3 id="再看逻辑"><a href="#再看逻辑" class="headerlink" title="再看逻辑"></a>再看逻辑</h3><pre class="line-numbers language-C" data-language="C"><code class="language-C">puts("[sign in]");
printf("[input your flag]: ");
__isoc99_scanf("%99s", input);
sub_96A(input, buffer);
__gmpz_init_set_str(C, "ad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35", 16LL);
__gmpz_init_set_str(M, buffer, 16LL);
__gmpz_init_set_str(mod, "103461035900816914121390101299049044413950405173712170434161686539878160984549", 10LL);
__gmpz_init_set_str(exp, "65537", 10LL);
__gmpz_powm(M, M, exp, mod);
if ( (unsigned int)__gmpz_cmp(M, C) )
  puts("GG!");
else
  puts("TTTTTTTTTTql!");<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>sub_96A</code>可以看作是对输入进行一个处理形成明文</p>
<p>RSA的架构就有了</p>
<pre class="line-numbers language-none"><code class="language-none">C = 'ad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35'

N = 103461035900816914121390101299049044413950405173712170434161686539878160984549

e = 65537<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过Yafu拆解大素数</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ yafu-x64.exe                                                                                                      
factor<span class="token punctuation">(</span><span class="token number">103461035900816914121390101299049044413950405173712170434161686539878160984549</span><span class="token punctuation">)</span>                              
                                                                                                                    
                                                                                                                    
fac: factoring <span class="token number">103461035900816914121390101299049044413950405173712170434161686539878160984549</span>                       
fac: using pretesting plan: normal                                                                                  
fac: no tune info: using qs/gnfs crossover of <span class="token number">95</span> digits                                                             
div: primes <span class="token function">less</span> than <span class="token number">10000</span>                                                                                         
fmt: <span class="token number">1000000</span> iterations                                                                                             
rho: x^2 + <span class="token number">3</span>, starting <span class="token number">1000</span> iterations on C78                                                                       
rho: x^2 + <span class="token number">2</span>, starting <span class="token number">1000</span> iterations on C78                                                                       
rho: x^2 + <span class="token number">1</span>, starting <span class="token number">1000</span> iterations on C78                                                                       
pm1: starting B1 <span class="token operator">=</span> 150K, B2 <span class="token operator">=</span> gmp-ecm default on C78                                                                
ecm: <span class="token number">30</span>/30 curves on C78, <span class="token assign-left variable">B1</span><span class="token operator">=</span>2K, <span class="token assign-left variable">B2</span><span class="token operator">=</span>gmp-ecm default                                                                 
ecm: <span class="token number">74</span>/74 curves on C78, <span class="token assign-left variable">B1</span><span class="token operator">=</span>11K, <span class="token assign-left variable">B2</span><span class="token operator">=</span>gmp-ecm default                                                                
ecm: <span class="token number">161</span>/161 curves on C78, <span class="token assign-left variable">B1</span><span class="token operator">=</span>50K, <span class="token assign-left variable">B2</span><span class="token operator">=</span>gmp-ecm default, ETA: <span class="token number">0</span> sec                                                  
                                                                                                                    
starting SIQS on c78: <span class="token number">103461035900816914121390101299049044413950405173712170434161686539878160984549</span>                
                                                                                                                    
<span class="token operator">==</span><span class="token operator">==</span> sieving <span class="token keyword">in</span> progress <span class="token punctuation">(</span><span class="token number">1</span> thread<span class="token punctuation">)</span>:   <span class="token number">36224</span> relations needed <span class="token operator">==</span><span class="token operator">==</span>                                                  
<span class="token operator">==</span><span class="token operator">==</span>           Press ctrl-c to abort and save state           <span class="token operator">==</span><span class="token operator">==</span>                                                  
<span class="token number">36257</span> rels found: <span class="token number">18839</span> full + <span class="token number">17418</span> from <span class="token number">185433</span> partial, <span class="token punctuation">(</span><span class="token number">3381.62</span> rels/sec<span class="token punctuation">)</span>                                        
                                                                                                                    
SIQS elapsed <span class="token function">time</span> <span class="token operator">=</span> <span class="token number">61.4377</span> seconds.                                                                                
Total factoring <span class="token function">time</span> <span class="token operator">=</span> <span class="token number">75.1933</span> seconds                                                                              
                                                                                                                    
                                                                                                                    
***factors found***                                                                                                 
                                                                                                                    
P39 <span class="token operator">=</span> <span class="token number">366669102002966856876605669837014229419</span>                                                                       
P39 <span class="token operator">=</span> <span class="token number">282164587459512124844245113950593348271</span>                                                                       
                                                                                                                    
ans <span class="token operator">=</span> <span class="token number">1</span>                                                                                                             <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>得</p>
<pre class="line-numbers language-none"><code class="language-none">p= 366669102002966856876605669837014229419

q = 282164587459512124844245113950593348271<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>



<h3 id="解密脚本-12"><a href="#解密脚本-12" class="headerlink" title="解密脚本"></a>解密脚本</h3><p>这里将整数转换成字符串遇到点问题</p>
<p>可以记录学习学习</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gmpy2
<span class="token keyword">import</span> binascii

p <span class="token operator">=</span> <span class="token number">366669102002966856876605669837014229419</span>
q <span class="token operator">=</span> <span class="token number">282164587459512124844245113950593348271</span>
N <span class="token operator">=</span> <span class="token number">103461035900816914121390101299049044413950405173712170434161686539878160984549</span>
c <span class="token operator">=</span> <span class="token number">0xad939ff59f6e70bcbfad406f2494993757eee98b91bc244184a377520d06fc35</span>
e <span class="token operator">=</span> <span class="token number">65537</span>

d <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>invert<span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>q<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> gmpy2<span class="token punctuation">.</span>powmod<span class="token punctuation">(</span>c<span class="token punctuation">,</span>d<span class="token punctuation">,</span>p<span class="token operator">*</span>q<span class="token punctuation">)</span>

temp <span class="token operator">=</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
tem <span class="token operator">=</span> binascii<span class="token punctuation">.</span>unhexlify<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>tem<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h1 id="异或"><a href="#异或" class="headerlink" title="异或"></a>异或</h1><ul>
<li><p>配合初始值+自身与自身其他位异或</p>
<p>解法：按原顺序操作顺序复原</p>
</li>
<li><p>异或操作用到了中间值</p>
<p>解法：逆向异或逐步恢复</p>
</li>
</ul>
<h2 id="FlareOn4-IgniteMe-按原顺序复原"><a href="#FlareOn4-IgniteMe-按原顺序复原" class="headerlink" title="[FlareOn4]IgniteMe(按原顺序复原)"></a>[FlareOn4]IgniteMe(按原顺序复原)</h2><h3 id="分析过程-2"><a href="#分析过程-2" class="headerlink" title="分析过程"></a>分析过程</h3><p>拿到题目函数调用方式挺奇怪</p>
<p>不过不影响判断逻辑</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">void __noreturn start()
{
  DWORD NumberOfBytesWritten; // [esp+0h] [ebp-4h] BYREF

  NumberOfBytesWritten = 0;
  hScanf = GetStdHandle(0xFFFFFFF6);
  hPrintf = GetStdHandle(0xFFFFFFF5);
  WriteFile(hPrintf, aG1v3M3T3hFl4g, 0x13u, &amp;NumberOfBytesWritten, 0);
  sub_4010F0();                                 // 获取输入并将输入放入全局变量input
  if ( sub_401050(NumberOfBytesWritten) )       // 主要验证逻辑
    WriteFile(hPrintf, aG00dJ0b, 0xAu, &amp;NumberOfBytesWritten, 0);
  else
    WriteFile(hPrintf, aN0tT00H0tRWe7r, 0x24u, &amp;NumberOfBytesWritten, 0);
  ExitProcess(0);
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>进入<code>sub_401050</code>看</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int sub_401050()
{
  int length; // [esp+0h] [ebp-Ch]
  int i; // [esp+4h] [ebp-8h]
  unsigned int j; // [esp+4h] [ebp-8h]
  char v4; // [esp+Bh] [ebp-1h]

  length = sub_401020((int)input);              // 获取长度
  v4 = sub_401000();                            // 计算固定值 v4 = 04
  for ( i = length - 1; i &gt;= 0; --i )
  {
    byte_403180[i] = v4 ^ input[i];
    v4 = input[i];
  }
  for ( j = 0; j &lt; 39; ++j )                    // 长度39
  {
    if ( byte_403180[j] != (unsigned __int8)byte_403000[j] )
      return 0;
  }
  return 1;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<ul>
<li><p><code>sub_401000</code>计算一个固定值</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">__int16 sub_401000()
{
  return (unsigned __int16)__ROL4__(0x80070000, 4) &gt;&gt; 1;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>0x80070000</code>循环左移4位之后为<code>0x00700008</code></p>
<p>算数右移之后为<code>0x00700004</code> 最后返回16位结果为<code>04</code></p>
<ul>
<li>从最后的判断可知长度为39，处理后的数组位于<code>byte_403000</code></li>
</ul>
<p>之后的操作是</p>
<ul>
<li><p>将输入从最后一位开始</p>
</li>
<li><p>当前位与上一位异或后存入值</p>
</li>
<li><p>第一次处理和初始值04异或 </p>
</li>
</ul>
<p>计算顺序为</p>
<pre class="line-numbers language-none"><code class="language-none">byte_403180[28] = input[28] ^ 04
byte_403180[27] = input[27] ^ input[28]
..
byte_403180[0] = input[0] ^ input[1]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li>
</ul>
<p>​    所以我们的解密算法需要从最后一位开始还原 按原来的顺序恢复input</p>
<h3 id="解密算法"><a href="#解密算法" class="headerlink" title="解密算法"></a>解密算法</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">byte_403000 <span class="token operator">=</span> <span class="token string">'\r&amp;IE*\x17xD+l]^E\x12/\x17+DonV\t_EGs&amp;\n\r\x13\x17HB\x01@M\x0c\x02i'</span>
v4 <span class="token operator">=</span> <span class="token number">4</span>
<span class="token builtin">input</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">''</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">39</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">38</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token builtin">input</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>byte_403000<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">^</span> v4<span class="token punctuation">)</span>
    v4 <span class="token operator">=</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token builtin">input</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> <span class="token builtin">input</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="GWCTF-2019-xxor"><a href="#GWCTF-2019-xxor" class="headerlink" title="[GWCTF 2019]xxor"></a>[GWCTF 2019]xxor</h2><h3 id="关键逻辑-2"><a href="#关键逻辑-2" class="headerlink" title="关键逻辑"></a>关键逻辑</h3><p><code>main</code></p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">__int64 __fastcall main(int a1, char **a2, char **a3)
{
  int i; // [rsp+8h] [rbp-68h]
  int j; // [rsp+Ch] [rbp-64h]
  __int64 v6[6]; // [rsp+10h] [rbp-60h] BYREF
  __int64 v7[6]; // [rsp+40h] [rbp-30h] BYREF

  v7[5] = __readfsqword(0x28u);
  puts("Let us play a game?");
  puts("you have six chances to input");
  puts("Come on!");
  v6[0] = 0LL;
  v6[1] = 0LL;
  v6[2] = 0LL;
  v6[3] = 0LL;
  v6[4] = 0LL;
  for ( i = 0; i &lt;= 5; ++i )
  {
    printf("%s", "input: ");
    a2 = (char **)((char *)v6 + 4 * i);         // 6个DWORD
    __isoc99_scanf("%d", a2);
  }
  v7[0] = 0LL;
  v7[1] = 0LL;
  v7[2] = 0LL;
  v7[3] = 0LL;
  v7[4] = 0LL;
  for ( j = 0; j &lt;= 2; ++j )
  {
    dword_601078 = v6[j];                       // 输入1
    dword_60107C = HIDWORD(v6[j]);              // 输入2
    a2 = (char **)dword_601060;
    sub_400686((unsigned int *)&amp;dword_601078, dword_601060);// 操作dword_601078 dword_60107C
    LODWORD(v7[j]) = dword_601078;
    HIDWORD(v7[j]) = dword_60107C;
  }
  if ( (unsigned int)sub_400770(v7, a2) != 1 )  // 验证v7数组
  {
    puts("NO NO NO~ ");
    exit(0);
  }
  puts("Congratulation!\n");
  puts("You seccess half\n");
  puts("Do not forget to change input to hex and combine~\n");
  puts("ByeBye");
  return 0LL;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><code>sub_400686</code></p>
<p><code>sub_400770</code></p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">__int64 __fastcall sub_400770(_DWORD *a1)
{
  __int64 result; // rax

  if ( a1[2] - a1[3] == 2225223423LL
    &amp;&amp; a1[3] + a1[4] == 4201428739LL
    &amp;&amp; a1[2] - a1[4] == 1121399208LL
    &amp;&amp; *a1 == -548868226
    &amp;&amp; a1[5] == -2064448480
    &amp;&amp; a1[1] == 550153460 )
  {
    puts("good!");
    result = 1LL;
  }
  else
  {
    puts("Wrong!");
    result = 0LL;
  }
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="分析过程-3"><a href="#分析过程-3" class="headerlink" title="分析过程"></a>分析过程</h3><p>从<code>sub_400770</code>入手得到v7数组</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">__int64 __fastcall sub_400770(_DWORD *a1)
{
  __int64 result; // rax

  if ( a1[2] - a1[3] == 0x84A236FFLL            // 三元一次方程
    &amp;&amp; a1[3] + a1[4] == 0xFA6CB703LL
    &amp;&amp; a1[2] - a1[4] == 0x42D731A8LL
    &amp;&amp; *a1 == 0xDF48EF7E
    &amp;&amp; a1[5] == 0x84F30420
    &amp;&amp; a1[1] == 0x20CAACF4 )
  {
    puts("good!");
    result = 1LL;
  }
  else
  {
    puts("Wrong!");
    result = 0LL;
  }
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里要解一个三元一次方程</p>
<p><img src="%E9%80%86%E5%90%91%E7%BB%83%E4%B9%A0%E8%AE%B0%E5%BD%95.assets/image-20220511165555214.png" alt="image-20220511165555214"></p>
<p>最后得v7数组如下</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">v7 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">6</span>
v7<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xDF48EF7E</span>
v7<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x20CAACF4</span>
v7<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x84F30420</span> 
v7<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0xe0f30fd5</span>
v7<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x5c50d8d6</span>
v7<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x9e1bde2d</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>接着从<code>sub_400686</code>逆推出输入即可</p>
<h3 id="解密脚本-13"><a href="#解密脚本-13" class="headerlink" title="解密脚本"></a>解密脚本</h3><p>因为都是在用32位寄存器操作，用python就显得不太方便。</p>
<p>直接copy伪代码跑起来</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">#include &lt;stdio.h&gt;
#include &lt;Windows.h&gt;
__int64 __fastcall sub_400686(unsigned int* input, int* dword_601060)
{
    __int64 result; // rax
    unsigned int firstDword; // [rsp+1Ch] [rbp-24h]
    unsigned int secondDword; // [rsp+20h] [rbp-20h]
    int v5; // [rsp+24h] [rbp-1Ch]
    unsigned int i; // [rsp+28h] [rbp-18h]

    firstDword = *input;                          // input1
    secondDword = input[1];                       // //input2
    
    v5 = 0x458BCD42 * 64;
    for (i = 0; i &lt;= 63; i++)
    {
        secondDword -= (firstDword + v5 + 20) ^ ((firstDword &lt;&lt; 6) + dword_601060[2]) ^ ((firstDword &gt;&gt; 9) + dword_601060[3]) ^ 0x10;
        firstDword -= (secondDword + v5 + 11) ^ ((secondDword &lt;&lt; 6) + *dword_601060) ^ ((secondDword &gt;&gt; 9) + dword_601060[1]) ^ 0x20;
        v5 -= 0x458BCD42;
    }
    *input = firstDword;
    result = secondDword;
    input[1] = secondDword;
    return result;
}

int main() {
    int dword_601060[4] = { 2,2,3,4 };
    int v7[6] = { 0 };
    v7[0] = 0xDF48EF7E;
    v7[1] = 0x20CAACF4;
    v7[5] = 0x84F30420;
    v7[2] = 0xe0f30fd5;
    v7[3] = 0x5c50d8d6;
    v7[4] = 0x9e1bde2d;
    for (int j = 0; j &lt;= 4; j += 2)
    {
        int dword_601078[2] = { 0 };
        dword_601078[0] = v7[j];                       // 输入1
        dword_601078[1] = v7[j + 1];                      // 输入2
        sub_400686((unsigned int*)&amp;dword_601078, dword_601060);// 操作dword_601078 dword_60107C
        v7[j] = dword_601078[0];
        v7[j + 1] = dword_601078[1];
    }
    for (int i = 0; i &lt; 6; i++) {
        printf("%c%c%c", *((char*)&amp;v7[i] + 2), *((char*)&amp;v7[i] + 1), *((char*)&amp;v7[i]));
    }
    return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>





<h1 id="base64换表"><a href="#base64换表" class="headerlink" title="base64换表"></a>base64换表</h1><h2 id="ACTF新生赛2020-usualCrypt-好评"><a href="#ACTF新生赛2020-usualCrypt-好评" class="headerlink" title="[ACTF新生赛2020]usualCrypt(好评)"></a>[ACTF新生赛2020]usualCrypt(好评)</h2><ul>
<li><p>base64编码是固定的字符处理</p>
<p>于是将按表中的差异直接替换即可</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">flag <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>maketrans<span class="token punctuation">(</span>string_trans<span class="token punctuation">,</span>string_bak<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></li>
</ul>
<h3 id="逻辑分析"><a href="#逻辑分析" class="headerlink" title="逻辑分析"></a>逻辑分析</h3><p>main函数</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">printf(aGiveMeYourFlag);
scanf("%s", input);
v5[0] = 0;
v5[1] = 0;
v5[2] = 0;
v6 = 0;
v7 = 0;
sub_401080(input, strlen(input), v5);
v3 = 0;
while ( *((_BYTE *)v5 + v3) == byte_40E0E4[v3] )
{
  if ( ++v3 &gt; strlen((const char *)v5) )
    goto LABEL_6;
}
printf(aError);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>录入输出经过函数<code>sub_401080</code>处理得v5</p>
<p>v5与<code>byte_40E0E4</code>进行比对</p>
<p><code>sub_401080</code>函数内容如下</p>
<p>可以看出是base64编码</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl sub_401080(int input, int length, int output)
{
  int v3; // edi
  int v4; // esi
  int v5; // edx
  int v6; // eax
  int v7; // ecx
  int v8; // esi
  int v9; // esi
  int v10; // esi
  int v11; // esi
  _BYTE *v12; // ecx
  int v13; // esi
  int lengtha; // [esp+18h] [ebp+8h]

  v3 = 0;
  v4 = 0;
  sub_401000();                                 // 对base64密码表进行处理
  v5 = length % 3;
  v6 = input;
  v7 = length - length % 3;
  lengtha = length % 3;
  if ( v7 &gt; 0 )
  {
    do
    {
      LOBYTE(v5) = *(_BYTE *)(input + v3);
      v3 += 3;
      v8 = v4 + 1;
      *(_BYTE *)(v8 + output - 1) = byte_40E0A0[(v5 &gt;&gt; 2) &amp; 0x3F];
      *(_BYTE *)(++v8 + output - 1) = byte_40E0A0[16 * (*(_BYTE *)(input + v3 - 3) &amp; 3)
                                                + (((int)*(unsigned __int8 *)(input + v3 - 2) &gt;&gt; 4) &amp; 0xF)];
      *(_BYTE *)(++v8 + output - 1) = byte_40E0A0[4 * (*(_BYTE *)(input + v3 - 2) &amp; 0xF)
                                                + (((int)*(unsigned __int8 *)(input + v3 - 1) &gt;&gt; 6) &amp; 3)];
      v5 = *(_BYTE *)(input + v3 - 1) &amp; 0x3F;
      v4 = v8 + 1;
      *(_BYTE *)(v4 + output - 1) = byte_40E0A0[v5];
    }
    while ( v3 &lt; v7 );
    v5 = lengtha;
  }
  if ( v5 == 1 )
  {
    LOBYTE(v7) = *(_BYTE *)(v3 + input);
    v9 = v4 + 1;
    *(_BYTE *)(v9 + output - 1) = byte_40E0A0[(v7 &gt;&gt; 2) &amp; 0x3F];
    v10 = v9 + 1;
    *(_BYTE *)(v10 + output - 1) = byte_40E0A0[16 * (*(_BYTE *)(v3 + input) &amp; 3)];
    *(_BYTE *)(v10 + output) = 61;
LABEL_8:
    v13 = v10 + 1;
    *(_BYTE *)(v13 + output) = 61;
    v4 = v13 + 1;
    goto LABEL_9;
  }
  if ( v5 == 2 )
  {
    v11 = v4 + 1;
    *(_BYTE *)(v11 + output - 1) = byte_40E0A0[((int)*(unsigned __int8 *)(v3 + input) &gt;&gt; 2) &amp; 0x3F];
    v12 = (_BYTE *)(v3 + input + 1);
    LOBYTE(v6) = *v12;
    v10 = v11 + 1;
    *(_BYTE *)(v10 + output - 1) = byte_40E0A0[16 * (*(_BYTE *)(v3 + input) &amp; 3) + ((v6 &gt;&gt; 4) &amp; 0xF)];
    *(_BYTE *)(v10 + output) = byte_40E0A0[4 * (*v12 &amp; 0xF)];
    goto LABEL_8;
  }
LABEL_9:
  *(_BYTE *)(v4 + output) = 0;
  return sub_401030(output);                    // 对base64编码的结果进行大小写互换
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以看到<code>sub_401000</code>里对base64密码表<code>byte_40E0A0</code>进行了处理</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int sub_401000()
{
  int result; // eax
  char v1; // cl

  for ( result = 6; result &lt; 15; ++result )
  {
    v1 = byte_40E0AA[result];
    byte_40E0AA[result] = byte_40E0A0[result];
    byte_40E0A0[result] = v1;
  }
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<p>最后返回结果前<code>sub_401030</code>对base64编码的结果进行大小写互换</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl sub_401030(const char *a1)
{
  __int64 v1; // rax
  char v2; // al

  v1 = 0i64;
  if ( strlen(a1) )
  {
    do
    {
      v2 = a1[HIDWORD(v1)];
      if ( v2 &lt; 'a' || v2 &gt; 'z' )
      {
        if ( v2 &lt; 'A' || v2 &gt; 'Z' )
          goto LABEL_9;
        LOBYTE(v1) = v2 + 32;
      }
      else
      {
        LOBYTE(v1) = v2 - 32;
      }
      a1[HIDWORD(v1)] = v1;
LABEL_9:
      LODWORD(v1) = 0;
      ++HIDWORD(v1);
    }
    while ( HIDWORD(v1) &lt; strlen(a1) );
  }
  return v1;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="解密思路"><a href="#解密思路" class="headerlink" title="解密思路"></a>解密思路</h3><ul>
<li><p>将加密后的结果进行大小写互换得到<code>byte_40E0E4</code></p>
</li>
<li><p>将base64密码表按<code>usb_401000</code>处理得到<code>string_trans</code></p>
</li>
<li><p>用处理后的密码表<code>string_trans</code>将<code>byte_40E0E4</code>解码</p>
</li>
<li><p>得Flag</p>
</li>
</ul>
<h3 id="解密脚本-14"><a href="#解密脚本-14" class="headerlink" title="解密脚本"></a>解密脚本</h3><p>这次学习了字符串替换</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64
<span class="token keyword">import</span> string

<span class="token keyword">def</span> <span class="token function">sub_401030</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> c <span class="token keyword">in</span> a<span class="token punctuation">:</span>
        <span class="token keyword">if</span> c <span class="token operator">&gt;=</span> <span class="token string">'a'</span> <span class="token keyword">and</span> c <span class="token operator">&lt;=</span> <span class="token string">'z'</span><span class="token punctuation">:</span>
            result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> c <span class="token operator">&gt;=</span> <span class="token string">'A'</span> <span class="token keyword">and</span> c <span class="token operator">&lt;=</span> <span class="token string">'Z'</span><span class="token punctuation">:</span>
            result <span class="token operator">+=</span> <span class="token builtin">chr</span><span class="token punctuation">(</span><span class="token builtin">ord</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            result <span class="token operator">+=</span> c
    <span class="token keyword">return</span> result

<span class="token keyword">def</span> <span class="token function">sub_401000</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    temp <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        tempv <span class="token operator">=</span> temp<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">0xA</span><span class="token punctuation">]</span>
        temp<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">0xA</span><span class="token punctuation">]</span> <span class="token operator">=</span> temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        temp<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> tempv
    res <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> temp<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> res

string_bak <span class="token operator">=</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>
string_trans <span class="token operator">=</span> sub_401000<span class="token punctuation">(</span>string_bak<span class="token punctuation">)</span>
byte_40E0E4 <span class="token operator">=</span> <span class="token string">'zMXHz3TIgnxLxJhFAdtZn2fFk3lYCrtPC2l9'</span>

byte_40E0E4 <span class="token operator">=</span> sub_401030<span class="token punctuation">(</span>byte_40E0E4<span class="token punctuation">)</span>
flag <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>byte_40E0E4<span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>maketrans<span class="token punctuation">(</span>string_trans<span class="token punctuation">,</span>string_bak<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="WUSTCTF2020-level3"><a href="#WUSTCTF2020-level3" class="headerlink" title="[WUSTCTF2020]level3"></a>[WUSTCTF2020]level3</h2><p>打开题目发现是个base64翻译机</p>
<h3 id="分析过程-4"><a href="#分析过程-4" class="headerlink" title="分析过程"></a>分析过程</h3><p>主函数逻辑如下</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">int __cdecl main(int argc, const char **argv, const char **envp)
{
  char *v3; // rax
  char v5; // [rsp+Fh] [rbp-41h]
  char v6[56]; // [rsp+10h] [rbp-40h] BYREF
  unsigned __int64 v7; // [rsp+48h] [rbp-8h]

  v7 = __readfsqword(0x28u);
  printf("Try my base64 program?.....\n&gt;");
  __isoc99_scanf("%20s", v6);
  v5 = time(0LL);
  srand(v5);
  if ( (rand() &amp; 1) != 0 )
  {
    v3 = base64_encode(v6);
    puts(v3);
    puts("Is there something wrong?");
  }
  else
  {
    puts("Sorry I think it's not prepared yet....");
    puts("And I get a strange string from my program which is different from the standard base64:");
    puts("d2G0ZjLwHjS7DmOzZAY0X2lzX3CoZV9zdNOydO9vZl9yZXZlcnGlfD==");
    puts("What's wrong??");
  }
  return 0;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现题目给出了待翻译字符串</p>
<p><code>d2G0ZjLwHjS7DmOzZAY0X2lzX3CoZV9zdNOydO9vZl9yZXZlcnGlfD==</code></p>
<p>但这表和标准的表不一样</p>
<p>于是看表的交叉引用</p>
<p><img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/image-20220512142429242.png" alt="image-20220512142429242"></p>
<p>发现<code>O_OLookAtYou</code>函数对表进行了局部换位操作</p>
<pre class="line-numbers language-C" data-language="C"><code class="language-C">__int64 O_OLookAtYou()
{
  __int64 result; // rax
  char v1; // [rsp+1h] [rbp-5h]
  int i; // [rsp+2h] [rbp-4h]

  for ( i = 0; i &lt;= 9; ++i )
  {
    v1 = base64_table[i];
    base64_table[i] = base64_table[19 - i];
    result = 19 - i;
    base64_table[result] = v1;
  }
  return result;
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>于是将表修改之后将题目提供的字符串解码即可获得flag</p>
<h3 id="解密脚本-15"><a href="#解密脚本-15" class="headerlink" title="解密脚本"></a>解密脚本</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> base64
table_bak <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span>
table <span class="token operator">=</span> <span class="token string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span>
table <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    temp <span class="token operator">=</span> table<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    table<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> table<span class="token punctuation">[</span><span class="token number">19</span> <span class="token operator">-</span> i<span class="token punctuation">]</span>
    table<span class="token punctuation">[</span><span class="token number">19</span> <span class="token operator">-</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> temp
table <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>c <span class="token keyword">for</span> c <span class="token keyword">in</span> table<span class="token punctuation">]</span><span class="token punctuation">)</span>

flag <span class="token operator">=</span> <span class="token string">'d2G0ZjLwHjS7DmOzZAY0X2lzX3CoZV9zdNOydO9vZl9yZXZlcnGlfD=='</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>flag<span class="token punctuation">.</span>translate<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">.</span>maketrans<span class="token punctuation">(</span>table<span class="token punctuation">,</span>table_bak<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h1 id="常用库方法"><a href="#常用库方法" class="headerlink" title="常用库方法"></a>常用库方法</h1><h2 id="字符处理"><a href="#字符处理" class="headerlink" title="字符处理"></a>字符处理</h2><ul>
<li><p>binascii</p>
<p>hexlify：字符串转hex</p>
<p>unhexlify：hex转字符串</p>
</li>
<li><p>base64</p>
<p>b64decode</p>
</li>
</ul>
<h2 id="密码学-1"><a href="#密码学-1" class="headerlink" title="密码学"></a>密码学</h2><ul>
<li><p>gmpy2</p>
<p>d = gmpy2.invert(e, phi)</p>
<p>m = gmpy2.powmod(c, d, p*q)</p>
</li>
<li><p>rsa</p>
<p>skey = rsa.PrivateKey(n, e, int(d), p, q)</p>
</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">import gmpy2
import rsa
d = gmpy2.invert(e,(p-1)*(q-1))
m = gmpy2.powmod(c,d,p*q)
n = 0xC0332C5C64AE47182F6C1C876D42336910545A58F7EEFEFC0BCAAF5AF341CCDD
e = 65537
p = 304008741604601924494328155975272418463
q = 2859604688904516379356294403726392834
phi = (p-1) * (q-1)
d = gmpy2.invert(e, phi)
skey = rsa.PrivateKey(n, e, int(d), p, q)
with open('.\\RSA\\flag.enc','rb+') as f:
    text = f.read()
    print(rsa.decrypt(text, skey))<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        Author:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Luluting</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        Link:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="http://luluting.github.io/2022/04/21/ni-xiang-lian-xi-ji-lu/">http://luluting.github.io/2022/04/21/ni-xiang-lian-xi-ji-lu/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        Reprint policy:
                    </i>
                </span>
                <span class="reprint-info">
                    All articles in this blog are used except for special statements
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    reprint policy. If reproduced, please indicate source
                    <a href="/about" target="_blank">Luluting</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>Copied successfully, please follow the reprint policy of this article</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">more</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/CTF/">
                                    <span class="chip bg-color">CTF</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="far fa-dot-circle"></i>&nbsp;Current
            </div>
            <div class="card">
                <a href="/2022/04/21/ni-xiang-lian-xi-ji-lu/">
                    <div class="card-image">
                        
                        <img src="https://raw.githubusercontent.com/Luluting/Bed/Little/img/QQ%E5%9B%BE%E7%89%8720220311191653.jpg" class="responsive-img" alt="逆向练习记录">
                        
                        <span class="card-title">逆向练习记录</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            好好学习，天天向上
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-04-21
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Reverse/" class="post-category">
                                    Reverse
                                </a>
                            
                            
                        </span>
                    </div>
                </div>

                
                <div class="card-action article-tags">
                    
                    <a href="/tags/CTF/">
                        <span class="chip bg-color">CTF</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/03/11/kernel/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/44.jpg" class="responsive-img" alt="Windows内核学习">
                        
                        <span class="card-title">Windows内核学习</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            记录一下加密与解密对于Windows内核的学习
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-03-11
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Windows/" class="post-category">
                                    Windows
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E5%86%85%E6%A0%B8/">
                        <span class="chip bg-color">内核</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="609872034"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <a href="/about" target="_blank">Luluting</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;Total visits:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;Total visitors:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/luluting" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:739806133@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=739806133" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 739806133" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
